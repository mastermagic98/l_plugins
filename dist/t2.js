(()=>{"use strict";function e(e,t){this.build=function(){var a={title:e.title||e.name||e.original_title||e.original_name||"Без назви",release_date:e.release_date||e.first_air_date||"0000",vote_average:e.vote_average||0,original_title:e.original_title||e.original_name||"",backdrop_path:e.backdrop_path||"",poster_path:e.poster_path||""};if(this.card=Lampa.Template.get("trailer",a),this.img=this.card.find("img")[0],this.is_youtube="rating"===t.type,this.rating=a.vote_average?a.vote_average.toFixed(1):"-",this.trailer_lang="",this.release_date="-",this.is_youtube)this.card.find(".card__title").text(a.title),this.card.find(".card__details").remove();else{var r=(a.release_date+"").slice(0,4);this.card.find(".card__title").text(a.title),this.card.find(".card__details").text(r+" - "+a.original_title),"-"!==this.rating?this.card.find(".card__view").append('<div class="card__rating">'+this.rating+"</div>"):this.card.find(".card__view").append('<div class="card__rating">-</div>'),this.card.find(".card__view").append('<div class="card__trailer-lang"></div>'),this.card.find(".card__view").append('<div class="card__release-date"></div>')}},this.cardImgBackground=function(t){return Lampa.Storage.field("background")?"poster"===Lampa.Storage.get("background_type","complex")&&window.innerWidth>790?t.backdrop_path?Lampa.Api.img(t.backdrop_path,"original"):this.is_youtube?"https://img.youtube.com/vi/"+e.id+"/hqdefault.jpg":"":t.backdrop_path?Lampa.Api.img(t.backdrop_path,"w500"):this.is_youtube?"https://img.youtube.com/vi/"+e.id+"/hqdefault.jpg":"":""},this.image=function(){var e=this;this.img.onload=function(){e.card.addClass("card--loaded")},this.img.onerror=function(){e.img.src="./img/img_broken.svg"}},this.loadTrailerInfo=function(){var a=this;this.is_youtube||this.trailer_lang||Api.videos(e,(function(r){var s=r.results?r.results.filter((function(e){return"Trailer"===e.type})):[],i=getPreferredLanguage(),l=s.find((function(e){return i.includes(e.iso_639_1)}))||s[0];if(a.trailer_lang=l?l.iso_639_1:"-","-"!==a.trailer_lang?a.card.find(".card__trailer-lang").text(a.trailer_lang.toUpperCase()):a.card.find(".card__trailer-lang").text("-"),"in_theaters"===t.type||"upcoming_movies"===t.type)if(e.release_details&&e.release_details.results){var n=getRegion(),o=e.release_details.results.find((function(e){return e.iso_3166_1===n}));if(o&&o.release_dates&&o.release_dates.length){var u=o.release_dates[0].release_date;a.release_date=formatDateToDDMMYYYY(u)}else e.release_date&&(a.release_date=formatDateToDDMMYYYY(e.release_date))}else e.release_date&&(a.release_date=formatDateToDDMMYYYY(e.release_date));else"new_series_seasons"!==t.type&&"upcoming_series"!==t.type||e.release_details&&e.release_details.first_air_date&&(a.release_date=formatDateToDDMMYYYY(e.release_details.first_air_date));a.card.find(".card__release-date").text(a.release_date)}),(function(){a.trailer_lang="-",a.card.find(".card__trailer-lang").text("-"),a.card.find(".card__release-date").text("-")}))},this.play=function(t){if(t)try{if(Lampa.Manifest.app_digital>=183){var a={title:Lampa.Utils.shortText(e.title||e.name,50),id:t,youtube:!0,url:"https://www.youtube.com/watch?v="+t,icon:'<img class="size-youtube" src="https://img.youtube.com/vi/'+t+'/default.jpg" />',template:"selectbox_icon"};Lampa.Player.play(a),Lampa.Player.playlist([a])}else Lampa.YouTube.play(t)}catch(e){Lampa.Noty.show("Помилка відтворення трейлера: "+e.message)}else Lampa.Noty.show(Lampa.Lang.translate("trailers_no_trailers"))},this.create=function(){var t=this;this.build(),this.card.on("hover:focus",(function(a,r){Lampa.Background.change(t.cardImgBackground(e)),t.onFocus(a.target,e,r),t.loadTrailerInfo()})).on("hover:enter",(function(){t.is_youtube?t.play(e.id):Api.videos(e,(function(e){var a=getPreferredLanguage(),r=e.results?e.results.filter((function(e){return"Trailer"===e.type})):[],s=r.find((function(e){return a.includes(e.iso_639_1)}))||r[0];s&&s.key?("uk"===a[0]&&"uk"!==s.iso_639_1&&"en"!==s.iso_639_1?Lampa.Noty.show(Lampa.Lang.translate("trailers_no_ua_trailer")):"ru"===a[0]&&"ru"!==s.iso_639_1&&"en"!==s.iso_639_1&&Lampa.Noty.show(Lampa.Lang.translate("trailers_no_ru_trailer")),t.play(s.key)):Lampa.Noty.show(Lampa.Lang.translate("trailers_no_trailers"))}),(function(){Lampa.Noty.show(Lampa.Lang.translate("trailers_no_trailers"))}))})).on("hover:long",(function(){if(!t.is_youtube){var a=[{title:Lampa.Lang.translate("trailers_view"),view:!0}];Lampa.Loading.start((function(){Api.clear(),Lampa.Loading.stop()})),Api.videos(e,(function(r){Lampa.Loading.stop();var s=getPreferredLanguage(),i=r.results?r.results.filter((function(e){return"Trailer"===e.type})):[];i.length&&(a.push({title:Lampa.Lang.translate("title_trailers"),separator:!0}),i.forEach((function(e){e.key&&s.includes(e.iso_639_1)&&a.push({title:e.name||"Trailer",id:e.key,subtitle:e.iso_639_1})}))),Lampa.Select.show({title:Lampa.Lang.translate("title_action"),items:a,onSelect:function(a){Lampa.Controller.toggle("content"),a.view?Lampa.Activity.push({url:"",component:"full",id:e.id,method:e.name?"tv":"movie",card:e,source:"tmdb"}):t.play(a.id)},onBack:function(){Lampa.Controller.toggle("content")}})}),(function(){Lampa.Loading.stop(),Lampa.Noty.show(Lampa.Lang.translate("trailers_no_trailers"))}))}})),this.image(),this.loadTrailerInfo()},this.destroy=function(){this.img.onerror=null,this.img.onload=null,this.img.src="",this.card.remove(),this.card=null,this.img=null},this.visible=function(){this.visibled||("rating"===t.type?this.img.src="https://img.youtube.com/vi/"+e.id+"/hqdefault.jpg":e.backdrop_path?this.img.src=Lampa.Api.img(e.backdrop_path,"w500"):e.poster_path?this.img.src=Lampa.Api.img(e.poster_path):this.img.src="./img/img_broken.svg",this.visibled=!0)},this.render=function(){return this.card}}function t(t){var a,r,s,i,l=this,n=Lampa.Template.get("items_line",{title:t.title}),o=n.find(".items-line__body"),u=new Lampa.Scroll({horizontal:!0,step:600}),c=Lampa.Storage.field("light_version")&&window.innerWidth>=767,_=[],d=0,p=c?6:10,g=0,m=!1;this.create=function(){u.render().find(".scroll__body").addClass("items-cards"),n.find(".items-line__title").text(t.title),(r=$('<div class="items-line__more selector"><svg width="36" height="36" viewBox="0 0 24 24" fill="currentColor"><path d="M10 18h4v-2h-4v2zM3 6v2h18V6H3zm3 7h12v-2H6v2z"/></svg></div>')).css({display:"inline-block",marginLeft:"10px",cursor:"pointer",padding:"0.5em",background:"transparent",border:"none"}),r.on("hover:enter",(function(){var e=[{title:Lampa.Lang.translate("trailers_filter_today"),value:"day",selected:"day"===Lampa.Storage.get("trailers_"+t.type+"_filter","day")},{title:Lampa.Lang.translate("trailers_filter_week"),value:"week",selected:"week"===Lampa.Storage.get("trailers_"+t.type+"_filter","day")},{title:Lampa.Lang.translate("trailers_filter_all"),value:"all",selected:"all"===Lampa.Storage.get("trailers_"+t.type+"_filter","day")}];Lampa.Select.show({title:Lampa.Lang.translate("trailers_filter"),items:e,onSelect:function(e){Lampa.Storage.set("trailers_"+t.type+"_filter",e.value),l.load(!0),Lampa.Controller.toggle("content")},onBack:function(){Lampa.Controller.toggle("content")}})})),n.find(".items-line__title").after(r),s=Lampa.Template.get("more",{}),(a=new e(s,{type:"more"})).create(),(s=a.render()).addClass("selector"),s.on("hover:enter",(function(){Lampa.Activity.push({url:t.url,title:t.title,component:"trailers_full",type:t.type,page:1})})),u.onWheel=function(e){e>0&&d<_.length-1?l.right():e<0&&d>0&&l.left()},this.load(),u.onScroll=function(){!m&&u.isEnd(1e3)&&l.load()},o.append(u.render())},this.load=function(a){if(!m){m=!0,a&&(g=0,u.clear(),_.forEach((function(e){e.destroy()})),_=[],d=0);var r=t.results.slice(g,g+p);Lampa.Storage.get("trailers_"+t.type+"_filter","day"),r.length?(r.forEach((function(a,r){var s=new e(a,{type:t.type});s.create(),_.push(s),u.append(s.render()),0!==r||i||(i=s.card,s.card.addClass("card--focus"))})),g+=r.length,m=!1):t.results.length>g?(u.append(s),m=!1):m=!1}},this.left=function(){d>0&&(d--,i=_[d].card,Lampa.Controller.moveTo(i,u.render()),u.scrollTo(i))},this.right=function(){d<_.length-1&&(d++,i=_[d].card,Lampa.Controller.moveTo(i,u.render()),u.scrollTo(i))},this.toggle=function(){Lampa.Controller.add("trailers_line",{toggle:function(){Lampa.Controller.collectionSet(u.render()),i&&Lampa.Controller.collectionFocus(i,u.render())},left:function(){l.left()},right:function(){l.right()},up:function(){Lampa.Controller.toggle("menu")},down:function(){Lampa.Controller.toggle("content")},back:function(){Lampa.Controller.toggle("menu")}}),Lampa.Controller.toggle("trailers_line")},this.render=function(){return n},this.destroy=function(){u.destroy(),_.forEach((function(e){e.destroy()})),a&&a.destroy(),n.remove()}}function a(e){var t=new Date;return e&&t.setDate(t.getDate()-e),t.getFullYear()+"-"+String(t.getMonth()+1).padStart(2,"0")+"-"+String(t.getDate()).padStart(2,"0")}function r(){var e=Lampa.Storage.get("language","ru");return"uk"===e?"UA":"ru"===e?"RU":"US"}function s(){return Lampa.Storage.get("language","ru")}function i(e){return function(e){if(Array.isArray(e))return l(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return l(e,t);var a={}.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?l(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=Array(t);a<t;a++)r[a]=e[a];return r}var n=new Lampa.Reguest,o=Lampa.TMDB.key(),u="https://api.themoviedb.org/3",c={};function _(e,t,a,r){var i=u+e+"&api_key="+o+"&page="+t+"&language="+s();n.silent(i,a,r)}function d(e,t,a){var i=r(),l=s(),c=new Date,_=new Date(c.getTime()-3888e6).toISOString().split("T")[0],d="".concat(u,"/movie/now_playing?api_key=").concat(o,"&language=").concat(l,"&page=").concat(e,"®ion=").concat(i,"&primary_release_date.gte=").concat(_);n.silent(d,(function(e){if(e.results&&e.results.length){var a=function(){var a=e.results.filter((function(e){if(e.release_details&&e.release_details.results){var t=e.release_details.results.find((function(e){return e.iso_3166_1===i}));if(t&&t.release_dates&&t.release_dates.length){var a=new Date(t.release_dates[0].release_date);return a>=new Date(_)&&a<=c}}if(e.release_date){var r=new Date(e.release_date);return r>=new Date(_)&&r<=c}return!1}));a.sort((function(e,t){var a,r,s=(null===(a=e.release_details)||void 0===a||null===(a=a.results)||void 0===a||null===(a=a.find((function(e){return e.iso_3166_1===i})))||void 0===a||null===(a=a.release_dates[0])||void 0===a?void 0:a.release_date)||e.release_date,l=(null===(r=t.release_details)||void 0===r||null===(r=r.results)||void 0===r||null===(r=r.find((function(e){return e.iso_3166_1===i})))||void 0===r||null===(r=r.release_dates[0])||void 0===r?void 0:r.release_date)||t.release_date;return new Date(l)-new Date(s)})),e.results=a,t(e)},r=e.results.length,s=0;e.results.forEach((function(e){var t=e.id;if(t){var i="".concat(u,"/movie/").concat(t,"/release_dates?api_key=").concat(o);n.silent(i,(function(t){e.release_details=t,++s===r&&a()}),(function(){e.release_details={results:[]},++s===r&&a()}))}else e.release_details={results:[]},++s===r&&a()}))}else t(e)}),a)}function p(e,t,i){var l=r(),c=a(0),_=a(-180),d=s(),p="".concat(u,"/discover/movie?api_key=").concat(o,"&language=").concat(d,"&page=").concat(e,"®ion=").concat(l,"&primary_release_date.gte=").concat(c,"&primary_release_date.lte=").concat(_,"&sort_by=popularity.desc");n.silent(p,(function(e){if(e.results&&e.results.length){var a=function(){var a=e.results.filter((function(e){var t;return!!e.release_date||!(null===(t=e.release_details)||void 0===t||null===(t=t.results)||void 0===t||!t.length)&&e.release_details.results.some((function(e){var t,a;return e.iso_3166_1===l&&(null===(t=e.release_dates)||void 0===t?void 0:t.length)&&(null===(a=e.release_dates[0])||void 0===a?void 0:a.release_date)}))}));a.sort((function(e,t){var a,r,s=(null===(a=e.release_details)||void 0===a||null===(a=a.results)||void 0===a||null===(a=a.find((function(e){return e.iso_3166_1===l})))||void 0===a||null===(a=a.release_dates[0])||void 0===a?void 0:a.release_date)||e.release_date,i=(null===(r=t.release_details)||void 0===r||null===(r=r.results)||void 0===r||null===(r=r.find((function(e){return e.iso_3166_1===l})))||void 0===r||null===(r=r.release_dates[0])||void 0===r?void 0:r.release_date)||t.release_date;return new Date(s)-new Date(i)})),console.log("TMDB results:",e.results.length,"Filtered results:",a.length),e.results=a,e.total_results=a.length,t(e)},r=e.results.length,s=0;e.results.forEach((function(e){var t=e.id;if(t){var i="".concat(u,"/movie/").concat(t,"/release_dates?api_key=").concat(o);n.silent(i,(function(t){e.release_details=t,++s===r&&a()}),(function(){e.release_details={results:[]},++s===r&&a()}))}else e.release_details={results:[]},++s===r&&a()}))}else t(e)}),i)}var g=function(e,t){var r=new Lampa.Status(6);r.onComplite=function(){var a=[];["popular_movies","in_theaters","upcoming_movies","popular_series","new_series_seasons","upcoming_series"].forEach((function(e){r.data[e]&&r.data[e].results&&r.data[e].results.length&&(c[e]={results:r.data[e].results,timestamp:Date.now()},Lampa.Storage.set("trailer_category_cache_"+e,c[e]),a.push(r.data[e]))})),a.length?e(a):t()};var s=function(e,t,a,s){s.title=e,s.type=t,s.url=a,r.append(t,s)},i=a(0),l=a(-180),n=a(90),o=a(-90);_("/discover/movie?sort_by=popularity.desc&vote_count.gte=1",1,(function(e){s(Lampa.Lang.translate("trailers_popular_movies"),"popular_movies","/discover/movie?sort_by=popularity.desc",{results:e.results||[]})}),(function(){s(Lampa.Lang.translate("trailers_popular_movies"),"popular_movies","/discover/movie?sort_by=popularity.desc",{results:[]})})),d(1,(function(e){s(Lampa.Lang.translate("trailers_in_theaters"),"in_theaters","/movie/now_playing",{results:e.results||[]})}),(function(){s(Lampa.Lang.translate("trailers_in_theaters"),"in_theaters","/movie/now_playing",{results:[]})})),p(1,(function(e){s(Lampa.Lang.translate("trailers_upcoming_movies"),"upcoming_movies","/discover/movie?primary_release_date.gte="+i+"&primary_release_date.lte="+l+"&sort_by=popularity.desc",{results:e.results||[]})}),(function(){s(Lampa.Lang.translate("trailers_upcoming_movies"),"upcoming_movies","/discover/movie?primary_release_date.gte="+i+"&primary_release_date.lte="+l+"&sort_by=popularity.desc",{results:[]})})),_("/discover/tv?sort_by=popularity.desc&vote_count.gte=1",1,(function(e){var t=e.results?e.results.filter((function(e){return!e.genre_ids.includes(99)&&!e.genre_ids.includes(10763)&&!e.genre_ids.includes(10764)})):[];s(Lampa.Lang.translate("trailers_popular_series"),"popular_series","/discover/tv?sort_by=popularity.desc",{results:t})}),(function(){s(Lampa.Lang.translate("trailers_popular_series"),"popular_series","/discover/tv?sort_by=popularity.desc",{results:[]})})),_("/discover/tv?air_date.gte="+n+"&air_date.lte="+o+"&sort_by=popularity.desc&vote_count.gte=1",1,(function(e){e.results&&e.results.forEach((function(e){e.release_details={first_air_date:e.first_air_date}})),s(Lampa.Lang.translate("trailers_new_series_seasons"),"new_series_seasons","/discover/tv?air_date.gte="+n+"&air_date.lte="+o+"&sort_by=popularity.desc",{results:e.results||[]})}),(function(){s(Lampa.Lang.translate("trailers_new_series_seasons"),"new_series_seasons","/discover/tv?air_date.gte="+n+"&air_date.lte="+o+"&sort_by=popularity.desc",{results:[]})})),_("/discover/tv?first_air_date.gte="+i+"&first_air_date.lte="+l+"&sort_by=popularity.desc&vote_count.gte=1",1,(function(e){e.results&&e.results.forEach((function(e){e.release_details={first_air_date:e.first_air_date}})),s(Lampa.Lang.translate("trailers_upcoming_series"),"upcoming_series","/discover/tv?first_air_date.gte="+i+"&first_air_date.lte="+l+"&sort_by=popularity.desc",{results:e.results||[]})}),(function(){s(Lampa.Lang.translate("trailers_upcoming_series"),"upcoming_series","/discover/tv?first_air_date.gte="+i+"&first_air_date.lte="+l+"&sort_by=popularity.desc",{results:[]})}))},m=function(e,t,s){if("in_theaters"===e.type){var l=function(){v.has(h)||h>y||L&&h>L?n():(v.add(h),d(h,(function(t){if(t&&t.results&&t.results.length){f=f.concat(t.results),1===h&&(L=t.total_pages||y);var a=(e.page-1)*m;Math.min(e.page*m,f.length),f.length>=a+1||h>=L||h>=y?n():(h++,l())}else h<L&&h<y?(h++,l()):n()}),s))},n=function(){var a=i(new Set(f.map(JSON.stringify))).map(JSON.parse);a.sort((function(e,t){var a,r,s=(null===(a=e.release_details)||void 0===a||null===(a=a.results)||void 0===a||null===(a=a.find((function(e){return e.iso_3166_1===o})))||void 0===a||null===(a=a.release_dates[0])||void 0===a?void 0:a.release_date)||e.release_date,i=(null===(r=t.release_details)||void 0===r||null===(r=r.results)||void 0===r||null===(r=r.find((function(e){return e.iso_3166_1===o})))||void 0===r||null===(r=r.release_dates[0])||void 0===r?void 0:r.release_date)||t.release_date;return new Date(i)-new Date(s)}));var r=(e.page-1)*m,s=Math.min(e.page*m,a.length),l=a.slice(r,s),n={dates:{maximum:u.toISOString().split("T")[0],minimum:g},page:e.page,results:l.length>0?l:a.slice(0,m),total_pages:Math.ceil(a.length/m)||1,total_results:a.length};c.in_theaters={results:a,timestamp:Date.now()},Lampa.Storage.set("trailer_category_cache_in_theaters",c.in_theaters),t(n)},o=r(),u=new Date,g=new Date(u.getTime()-3888e6).toISOString().split("T")[0],m=20,f=[],v=new Set,h=1,y=30,L=0;if((x=c.in_theaters||Lampa.Storage.get("trailer_category_cache_in_theaters",null))&&x.results&&x.results.length>0){f=x.results;var w=(e.page-1)*m,S=Math.min(e.page*m,f.length),b=f.slice(w,S),C={dates:{maximum:u.toISOString().split("T")[0],minimum:g},page:e.page,results:b,total_pages:Math.ceil(f.length/m)||1,total_results:f.length};if(f.length>=w+1&&b.length>0)return void t(C);h=Math.ceil(f.length/m)+1}l()}else if("upcoming_movies"===e.type){var k=function(){v.has(h)||h>y?D():(v.add(h),p(h,(function(t){if(t&&t.results&&t.results.length){f=f.concat(t.results),e.page;var a=Math.min(e.page*m,f.length);f.length>=a||h>=y?D():(h++,k())}else D()}),(function(){h<y?(h++,k()):D()})))},D=function(){var a=i(new Set(f.map(JSON.stringify))).map(JSON.parse);(a=a.filter((function(e){var t;return!!e.release_date||!(null===(t=e.release_details)||void 0===t||null===(t=t.results)||void 0===t||!t.length)&&e.release_details.results.some((function(e){var t,a;return e.iso_3166_1===r()&&(null===(t=e.release_dates)||void 0===t?void 0:t.length)&&(null===(a=e.release_dates[0])||void 0===a?void 0:a.release_date)}))}))).sort((function(e,t){var a,s,i=(null===(a=e.release_details)||void 0===a||null===(a=a.results)||void 0===a||null===(a=a.find((function(e){return e.iso_3166_1===r()})))||void 0===a||null===(a=a.release_dates[0])||void 0===a?void 0:a.release_date)||e.release_date,l=(null===(s=t.release_details)||void 0===s||null===(s=s.results)||void 0===s||null===(s=s.find((function(e){return e.iso_3166_1===r()})))||void 0===s||null===(s=s.release_dates[0])||void 0===s?void 0:s.release_date)||t.release_date;return new Date(i)-new Date(l)})),console.log("Accumulated results:",f.length,"Final results:",a.length);var s=(e.page-1)*m,l=Math.min(e.page*m,a.length),n=a.slice(s,l),o={page:e.page,results:n.length>0?n:a.slice(0,m),total_pages:Math.ceil(a.length/m)||1,total_results:a.length};c.upcoming_movies={results:a,timestamp:Date.now()},Lampa.Storage.set("trailer_category_cache_upcoming_movies",c.upcoming_movies),t(o)},T=(u=a(0),a(-180));if(m=20,f=[],v=new Set,h=e.page,y=10,(x=c.upcoming_movies||Lampa.Storage.get("trailer_category_cache_upcoming_movies",null))&&x.results&&x.results.length>0&&(f=x.results.filter((function(e){var t;return!!e.release_date||!(null===(t=e.release_details)||void 0===t||null===(t=t.results)||void 0===t||!t.length)&&e.release_details.results.some((function(e){var t,a;return e.iso_3166_1===r()&&(null===(t=e.release_dates)||void 0===t?void 0:t.length)&&(null===(a=e.release_dates[0])||void 0===a?void 0:a.release_date)}))})),w=(e.page-1)*m,S=Math.min(e.page*m,f.length),b=f.slice(w,S),C={page:e.page,results:b,total_pages:Math.ceil(f.length/m)||1,total_results:f.length},b.length>0&&f.length>=w+1))return void t(C);k()}else if("new_series_seasons"===e.type){var M=a(90),A=a(-90);if((x=c.new_series_seasons||Lampa.Storage.get("trailer_category_cache_new_series_seasons",null))&&x.results&&(m=20,w=(e.page-1)*m,S=e.page*m,(C={page:e.page,results:x.results.slice(w,S),total_pages:Math.ceil(x.results.length/m),total_results:x.results.length}).results.length>0))return void t(C);_("/discover/tv?air_date.gte="+M+"&air_date.lte="+A+"&sort_by=popularity.desc&vote_count.gte=1",e.page,(function(a){if(a&&a.results&&a.results.length){if(a.results.forEach((function(e){e.release_details={first_air_date:e.first_air_date}})),1===e.page)c.new_series_seasons={results:a.results,timestamp:Date.now()},Lampa.Storage.set("trailer_category_cache_new_series_seasons",c.new_series_seasons);else{var r=c.new_series_seasons||Lampa.Storage.get("trailer_category_cache_new_series_seasons",{results:[]});r.results=r.results.concat(a.results),c.new_series_seasons=r,Lampa.Storage.set("trailer_category_cache_new_series_seasons",r)}t(a)}else s()}),s)}else if("upcoming_series"===e.type){if(u=a(0),T=a(-180),(x=c.upcoming_series||Lampa.Storage.get("trailer_category_cache_upcoming_series",null))&&x.results&&(m=20,w=(e.page-1)*m,S=e.page*m,(C={page:e.page,results:x.results.slice(w,S),total_pages:Math.ceil(x.results.length/m),total_results:x.results.length}).results.length>0))return void t(C);_("/discover/tv?first_air_date.gte="+u+"&first_air_date.lte="+T+"&sort_by=popularity.desc&vote_count.gte=1",e.page,(function(a){if(a&&a.results&&a.results.length){if(a.results.forEach((function(e){e.release_details={first_air_date:e.first_air_date}})),1===e.page)c.upcoming_series={results:a.results,timestamp:Date.now()},Lampa.Storage.set("trailer_category_cache_upcoming_series",c.upcoming_series);else{var r=c.upcoming_series||Lampa.Storage.get("trailer_category_cache_upcoming_series",{results:[]});r.results=r.results.concat(a.results),c.upcoming_series=r,Lampa.Storage.set("trailer_category_cache_upcoming_series",r)}t(a)}else s()}),s)}else{var x;if((x=c[e.type]||Lampa.Storage.get("trailer_category_cache_"+e.type,null))&&x.results&&(m=20,w=(e.page-1)*m,S=e.page*m,(C={page:e.page,results:x.results.slice(w,S),total_pages:Math.ceil(x.results.length/m),total_results:x.results.length}).results.length>0))return void t(C);_(e.url,e.page,(function(a){if(a&&a.results&&a.results.length){if(1===e.page)c[e.type]={results:a.results,timestamp:Date.now()},Lampa.Storage.set("trailer_category_cache_"+e.type,c[e.type]);else{var r=c[e.type]||Lampa.Storage.get("trailer_category_cache_"+e.type,{results:[]});r.results=r.results.concat(a.results),c[e.type]=r,Lampa.Storage.set("trailer_category_cache_"+e.type,r)}t(a)}else s()}),s)}};function f(t){var a,r=this,s=new Lampa.Scroll({mask:!0,over:!0}),i=[],l=$("<div></div>"),n=0;this.create=function(){return s.render().addClass("trailers-full"),m(t,(function(l){if((l.results||[]).forEach((function(r,l){var n=new e(r,{type:t.type});n.create(),i.push(n),s.append(n.render()),0===l&&(a=n.card,n.card.addClass("card--focus"))})),l.total_pages>l.page){var o=Lampa.Template.get("more",{}),u=new e(o,{type:"more"});u.create(),(o=u.render()).addClass("selector"),o.on("hover:enter",(function(){Lampa.Activity.push({url:t.url,title:t.title,component:"trailers_full",type:t.type,page:l.page+1})})),s.append(o),i.push(u)}s.onWheel=function(e){e>0&&n<i.length-1?r.right():e<0&&n>0&&r.left()},r.toggle()}),(function(){Lampa.Noty.show(Lampa.Lang.translate("trailers_no_data"))})),l.append(s.render()),l},this.left=function(){n>0&&(n--,a=i[n].card,Lampa.Controller.moveTo(a,s.render()),s.scrollTo(a))},this.right=function(){n<i.length-1&&(n++,a=i[n].card,Lampa.Controller.moveTo(a,s.render()),s.scrollTo(a))},this.toggle=function(){Lampa.Controller.add("trailers_full",{toggle:function(){Lampa.Controller.collectionSet(s.render()),a&&Lampa.Controller.collectionFocus(a,s.render())},left:function(){r.left()},right:function(){r.right()},up:function(){Lampa.Controller.toggle("menu")},down:function(){Lampa.Controller.toggle("content")},back:function(){Lampa.Controller.toggle("menu")}}),Lampa.Controller.toggle("trailers_full")},this.render=function(){return l},this.destroy=function(){s.destroy(),i.forEach((function(e){e.destroy()})),l.remove()}}function v(e){var a=this,r=new Lampa.Scroll({mask:!0,over:!0}),s=[],i=$("<div></div>");this.create=function(){return r.render().addClass("trailers-main"),g((function(e){e.forEach((function(e){var a=new t(e);a.create(),s.push(a),r.append(a.render())})),a.toggle()}),(function(){Lampa.Noty.show(Lampa.Lang.translate("trailers_no_data"))})),i.append(r.render()),i},this.start=function(){Lampa.Controller.toggle("trailers_main")},this.toggle=function(){Lampa.Controller.add("trailers_main",{toggle:function(){Lampa.Controller.collectionSet(r.render()),Lampa.Controller.collectionFocus(!1,r.render())},up:function(){Lampa.Controller.toggle("menu")},down:function(){Lampa.Controller.toggle("content")},back:function(){Lampa.Controller.toggle("menu")}}),Lampa.Controller.toggle("trailers_main")},this.render=function(){return i},this.destroy=function(){r.destroy(),s.forEach((function(e){e.destroy()})),i.remove()}}window.plugin_trailers_ready||function(){if(!window.plugin_trailers_ready){window.plugin_trailers_ready=!0;var e=Lampa.Storage.get("language","ru");e!==Lampa.Storage.get("trailer_last_lang","")&&(["popular_movies","in_theaters","upcoming_movies","popular_series","new_series_seasons","upcoming_series"].forEach((function(e){Lampa.Storage.set("trailer_category_cache_"+e,null)})),Lampa.Storage.set("trailer_last_lang",e)),Lampa.Component.add("trailers_main",v),Lampa.Component.add("trailers_full",f),Lampa.Template.add("trailer",['<div class="card card--trailer selector">','    <div class="card__view">','        <img class="card__img" />',"    </div>",'    <div class="card__info">','        <div class="card__title"></div>','        <div class="card__details"></div>',"    </div>","</div>"].join("")),Lampa.Template.add("items_line",['<div class="items-line">','    <div class="items-line__header">','        <div class="items-line__title"></div>',"    </div>",'    <div class="items-line__body"></div>',"</div>"].join("")),Lampa.Template.add("more",['<div class="card card--more selector">','    <div class="card__view">','        <div class="card__more">','            <svg width="36" height="36" viewBox="0 0 24 24" fill="currentColor">','                <path d="M12 22c1.1 0 2-.9 2-2h-4c0 1.1.9 2 2 2zm6-6v-5c0-3.07-1.63-5.64-4.5-6.32V4c0-1.1-.9-2-2-2s-2 .9-2 2v.68C6.63 5.36 5 7.92 5 11v5l-2 2v1h18v-1l-2-2z"/>',"            </svg>","        </div>","    </div>","</div>"].join(""));var t={title:Lampa.Lang.translate("trailers_main"),url:"",component:"trailers_main",tab:"trailers"},a=Lampa.Storage.get("menu","[]").filter((function(e){return"trailers_main"!==e.component}));a.splice(1,0,t),Lampa.Storage.set("menu",a),Lampa.Listener.follow("app",(function(e){"ready"===e.type&&setTimeout((function(){Lampa.Storage.get("trailers_start",!0)&&(Lampa.Storage.set("trailers_start",!1),Lampa.Activity.push({url:"",title:Lampa.Lang.translate("trailers_main"),component:"trailers_main",page:1}))}),1e3)}))}}()})();