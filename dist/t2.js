(()=>{var e={430:()=>{}},t={};function a(r){var i=t[r];if(void 0!==i)return i.exports;var n=t[r]={exports:{}};return e[r](n,n.exports,a),n.exports}(()=>{"use strict";function e(e,t){this.build=function(){var a={title:e.title||e.name||e.original_title||e.original_name||"Без назви",release_date:e.release_date||e.first_air_date||"0000",vote_average:e.vote_average||0,original_title:e.original_title||e.original_name||"",backdrop_path:e.backdrop_path||"",poster_path:e.poster_path||""};if(this.card=Lampa.Template.get("trailer",a),this.img=this.card.find("img")[0],this.is_youtube="rating"===t.type,this.rating=a.vote_average?a.vote_average.toFixed(1):"-",this.trailer_lang="",this.release_date="-",this.is_youtube)this.card.find(".card__title").text(a.title),this.card.find(".card__details").remove();else{var r=(a.release_date+"").slice(0,4);this.card.find(".card__title").text(a.title),this.card.find(".card__details").text(r+" - "+a.original_title),"-"!==this.rating?this.card.find(".card__view").append('<div class="card__rating">'+this.rating+"</div>"):this.card.find(".card__view").append('<div class="card__rating">-</div>'),this.card.find(".card__view").append('<div class="card__trailer-lang"></div>'),this.card.find(".card__view").append('<div class="card__release-date"></div>')}},this.cardImgBackground=function(t){return Lampa.Storage.field("background")?"poster"===Lampa.Storage.get("background_type","complex")&&window.innerWidth>790?t.backdrop_path?Lampa.Api.img(t.backdrop_path,"original"):this.is_youtube?"https://img.youtube.com/vi/"+e.id+"/hqdefault.jpg":"":t.backdrop_path?Lampa.Api.img(t.backdrop_path,"w500"):this.is_youtube?"https://img.youtube.com/vi/"+e.id+"/hqdefault.jpg":"":""},this.image=function(){var e=this;this.img.onload=function(){e.card.addClass("card--loaded")},this.img.onerror=function(){e.img.src="./img/img_broken.svg"}},this.loadTrailerInfo=function(){var a=this;this.is_youtube||this.trailer_lang||Api.videos(e,(function(r){var i=r.results?r.results.filter((function(e){return"Trailer"===e.type})):[],n=getPreferredLanguage(),l=i.find((function(e){return n.includes(e.iso_639_1)}))||i[0];if(a.trailer_lang=l?l.iso_639_1:"-","-"!==a.trailer_lang?a.card.find(".card__trailer-lang").text(a.trailer_lang.toUpperCase()):a.card.find(".card__trailer-lang").text("-"),"in_theaters"===t.type||"upcoming_movies"===t.type)if(e.release_details&&e.release_details.results){var o=getRegion(),s=e.release_details.results.find((function(e){return e.iso_3166_1===o}));if(s&&s.release_dates&&s.release_dates.length){var d=s.release_dates[0].release_date;a.release_date=formatDateToDDMMYYYY(d)}else e.release_date&&(a.release_date=formatDateToDDMMYYYY(e.release_date))}else e.release_date&&(a.release_date=formatDateToDDMMYYYY(e.release_date));else"new_series_seasons"!==t.type&&"upcoming_series"!==t.type||e.release_details&&e.release_details.first_air_date&&(a.release_date=formatDateToDDMMYYYY(e.release_details.first_air_date));a.card.find(".card__release-date").text(a.release_date)}),(function(){a.trailer_lang="-",a.card.find(".card__trailer-lang").text("-"),a.card.find(".card__release-date").text("-")}))},this.play=function(t){if(t)try{if(Lampa.Manifest.app_digital>=183){var a={title:Lampa.Utils.shortText(e.title||e.name,50),id:t,youtube:!0,url:"https://www.youtube.com/watch?v="+t,icon:'<img class="size-youtube" src="https://img.youtube.com/vi/'+t+'/default.jpg" />',template:"selectbox_icon"};Lampa.Player.play(a),Lampa.Player.playlist([a])}else Lampa.YouTube.play(t)}catch(e){Lampa.Noty.show("Помилка відтворення трейлера: "+e.message)}else Lampa.Noty.show(Lampa.Lang.translate("trailers_no_trailers"))},this.create=function(){var t=this;this.build(),this.card.on("hover:focus",(function(a,r){Lampa.Background.change(t.cardImgBackground(e)),t.onFocus(a.target,e,r),t.loadTrailerInfo()})).on("hover:enter",(function(){t.is_youtube?t.play(e.id):Api.videos(e,(function(e){var a=getPreferredLanguage(),r=e.results?e.results.filter((function(e){return"Trailer"===e.type})):[],i=r.find((function(e){return a.includes(e.iso_639_1)}))||r[0];i&&i.key?("uk"===a[0]&&"uk"!==i.iso_639_1&&"en"!==i.iso_639_1?Lampa.Noty.show(Lampa.Lang.translate("trailers_no_ua_trailer")):"ru"===a[0]&&"ru"!==i.iso_639_1&&"en"!==i.iso_639_1&&Lampa.Noty.show(Lampa.Lang.translate("trailers_no_ru_trailer")),t.play(i.key)):Lampa.Noty.show(Lampa.Lang.translate("trailers_no_trailers"))}),(function(){Lampa.Noty.show(Lampa.Lang.translate("trailers_no_trailers"))}))})).on("hover:long",(function(){if(!t.is_youtube){var a=[{title:Lampa.Lang.translate("trailers_view"),view:!0}];Lampa.Loading.start((function(){Api.clear(),Lampa.Loading.stop()})),Api.videos(e,(function(r){Lampa.Loading.stop();var i=getPreferredLanguage(),n=r.results?r.results.filter((function(e){return"Trailer"===e.type})):[];n.length&&(a.push({title:Lampa.Lang.translate("title_trailers"),separator:!0}),n.forEach((function(e){e.key&&i.includes(e.iso_639_1)&&a.push({title:e.name||"Trailer",id:e.key,subtitle:e.iso_639_1})}))),Lampa.Select.show({title:Lampa.Lang.translate("title_action"),items:a,onSelect:function(a){Lampa.Controller.toggle("content"),a.view?Lampa.Activity.push({url:"",component:"full",id:e.id,method:e.name?"tv":"movie",card:e,source:"tmdb"}):t.play(a.id)},onBack:function(){Lampa.Controller.toggle("content")}})}),(function(){Lampa.Loading.stop(),Lampa.Noty.show(Lampa.Lang.translate("trailers_no_trailers"))}))}})),this.image(),this.loadTrailerInfo()},this.destroy=function(){this.img.onerror=null,this.img.onload=null,this.img.src="",this.card.remove(),this.card=null,this.img=null},this.visible=function(){this.visibled||("rating"===t.type?this.img.src="https://img.youtube.com/vi/"+e.id+"/hqdefault.jpg":e.backdrop_path?this.img.src=Lampa.Api.img(e.backdrop_path,"w500"):e.poster_path?this.img.src=Lampa.Api.img(e.poster_path):this.img.src="./img/img_broken.svg",this.visibled=!0)},this.render=function(){return this.card}}function t(t){var a,r,i,n,l=this,o=Lampa.Template.get("items_line",{title:t.title}),s=o.find(".items-line__body"),d=new Lampa.Scroll({horizontal:!0,step:600}),c=Lampa.Storage.field("light_version")&&window.innerWidth>=767,p=[],u=0,_=c?6:10,m=0,g=!1;this.create=function(){d.render().find(".scroll__body").addClass("items-cards"),o.find(".items-line__title").text(t.title),(r=$('<div class="items-line__more selector"><svg width="36" height="36" viewBox="0 0 24 24" fill="currentColor"><path d="M10 18h4v-2h-4v2zM3 6v2h18V6H3zm3 7h12v-2H6v2z"/></svg></div>')).css({display:"inline-block",marginLeft:"10px",cursor:"pointer",padding:"0.5em",background:"transparent",border:"none"}),r.on("hover:enter",(function(){var e=[{title:Lampa.Lang.translate("trailers_filter_today"),value:"day",selected:"day"===Lampa.Storage.get("trailers_"+t.type+"_filter","day")},{title:Lampa.Lang.translate("trailers_filter_week"),value:"week",selected:"week"===Lampa.Storage.get("trailers_"+t.type+"_filter","day")},{title:Lampa.Lang.translate("trailers_filter_all"),value:"all",selected:"all"===Lampa.Storage.get("trailers_"+t.type+"_filter","day")}];Lampa.Select.show({title:Lampa.Lang.translate("trailers_filter"),items:e,onSelect:function(e){Lampa.Storage.set("trailers_"+t.type+"_filter",e.value),l.load(!0),Lampa.Controller.toggle("content")},onBack:function(){Lampa.Controller.toggle("content")}})})),o.find(".items-line__title").after(r),i=Lampa.Template.get("more",{}),(a=new e(i,{type:"more"})).create(),(i=a.render()).addClass("selector"),i.on("hover:enter",(function(){Lampa.Activity.push({url:t.url,title:t.title,component:"trailers_full",type:t.type,page:1})})),d.onWheel=function(e){e>0&&u<p.length-1?l.right():e<0&&u>0&&l.left()},this.load(),d.onScroll=function(){!g&&d.isEnd(1e3)&&l.load()},s.append(d.render())},this.load=function(a){if(!g){g=!0,a&&(m=0,d.clear(),p.forEach((function(e){e.destroy()})),p=[],u=0);var r=t.results.slice(m,m+_);Lampa.Storage.get("trailers_"+t.type+"_filter","day"),r.length?(r.forEach((function(a,r){var i=new e(a,{type:t.type});i.create(),p.push(i),d.append(i.render()),0!==r||n||(n=i.card,i.card.addClass("card--focus"))})),m+=r.length,g=!1):t.results.length>m?(d.append(i),g=!1):g=!1}},this.left=function(){u>0&&(u--,n=p[u].card,Lampa.Controller.moveTo(n,d.render()),d.scrollTo(n))},this.right=function(){u<p.length-1&&(u++,n=p[u].card,Lampa.Controller.moveTo(n,d.render()),d.scrollTo(n))},this.toggle=function(){Lampa.Controller.add("trailers_line",{toggle:function(){Lampa.Controller.collectionSet(d.render()),n&&Lampa.Controller.collectionFocus(n,d.render())},left:function(){l.left()},right:function(){l.right()},up:function(){Lampa.Controller.toggle("menu")},down:function(){Lampa.Controller.toggle("content")},back:function(){Lampa.Controller.toggle("menu")}}),Lampa.Controller.toggle("trailers_line")},this.render=function(){return o},this.destroy=function(){d.destroy(),p.forEach((function(e){e.destroy()})),a&&a.destroy(),o.remove()}}var r=a(430);function i(t){var a,i=this,n=new Lampa.Scroll({mask:!0,over:!0}),l=[],o=$("<div></div>"),s=0;this.create=function(){return n.render().addClass("trailers-full"),r.Api.full(t,(function(r){if((r.results||[]).forEach((function(r,i){var o=new e(r,{type:t.type});o.create(),l.push(o),n.append(o.render()),0===i&&(a=o.card,o.card.addClass("card--focus"))})),r.total_pages>r.page){var o=Lampa.Template.get("more",{}),d=new e(o,{type:"more"});d.create(),(o=d.render()).addClass("selector"),o.on("hover:enter",(function(){Lampa.Activity.push({url:t.url,title:t.title,component:"trailers_full",type:t.type,page:r.page+1})})),n.append(o),l.push(d)}n.onWheel=function(e){e>0&&s<l.length-1?i.right():e<0&&s>0&&i.left()},i.toggle()}),(function(){Lampa.Noty.show(Lampa.Lang.translate("trailers_no_data"))})),o.append(n.render()),o},this.left=function(){s>0&&(s--,a=l[s].card,Lampa.Controller.moveTo(a,n.render()),n.scrollTo(a))},this.right=function(){s<l.length-1&&(s++,a=l[s].card,Lampa.Controller.moveTo(a,n.render()),n.scrollTo(a))},this.toggle=function(){Lampa.Controller.add("trailers_full",{toggle:function(){Lampa.Controller.collectionSet(n.render()),a&&Lampa.Controller.collectionFocus(a,n.render())},left:function(){i.left()},right:function(){i.right()},up:function(){Lampa.Controller.toggle("menu")},down:function(){Lampa.Controller.toggle("content")},back:function(){Lampa.Controller.toggle("menu")}}),Lampa.Controller.toggle("trailers_full")},this.render=function(){return o},this.destroy=function(){n.destroy(),l.forEach((function(e){e.destroy()})),o.remove()}}function n(e){var a=this,i=new Lampa.Scroll({mask:!0,over:!0}),n=[],l=$("<div></div>");this.create=function(){return i.render().addClass("trailers-main"),r.Api.main((function(e){e.forEach((function(e){var a=new t(e);a.create(),n.push(a),i.append(a.render())})),a.toggle()}),(function(){Lampa.Noty.show(Lampa.Lang.translate("trailers_no_data"))})),l.append(i.render()),l},this.start=function(){Lampa.Controller.toggle("trailers_main")},this.toggle=function(){Lampa.Controller.add("trailers_main",{toggle:function(){Lampa.Controller.collectionSet(i.render()),Lampa.Controller.collectionFocus(!1,i.render())},up:function(){Lampa.Controller.toggle("menu")},down:function(){Lampa.Controller.toggle("content")},back:function(){Lampa.Controller.toggle("menu")}}),Lampa.Controller.toggle("trailers_main")},this.render=function(){return l},this.destroy=function(){i.destroy(),n.forEach((function(e){e.destroy()})),l.remove()}}window.plugin_trailers_ready||function(){if(!window.plugin_trailers_ready){window.plugin_trailers_ready=!0;var e=Lampa.Storage.get("language","ru");e!==Lampa.Storage.get("trailer_last_lang","")&&(["popular_movies","in_theaters","upcoming_movies","popular_series","new_series_seasons","upcoming_series"].forEach((function(e){Lampa.Storage.set("trailer_category_cache_"+e,null)})),Lampa.Storage.set("trailer_last_lang",e)),Lampa.Component.add("trailers_main",n),Lampa.Component.add("trailers_full",i),Lampa.Template.add("trailer",['<div class="card card--trailer selector">','    <div class="card__view">','        <img class="card__img" />',"    </div>",'    <div class="card__info">','        <div class="card__title"></div>','        <div class="card__details"></div>',"    </div>","</div>"].join("")),Lampa.Template.add("items_line",['<div class="items-line">','    <div class="items-line__header">','        <div class="items-line__title"></div>',"    </div>",'    <div class="items-line__body"></div>',"</div>"].join("")),Lampa.Template.add("more",['<div class="card card--more selector">','    <div class="card__view">','        <div class="card__more">','            <svg width="36" height="36" viewBox="0 0 24 24" fill="currentColor">','                <path d="M12 22c1.1 0 2-.9 2-2h-4c0 1.1.9 2 2 2zm6-6v-5c0-3.07-1.63-5.64-4.5-6.32V4c0-1.1-.9-2-2-2s-2 .9-2 2v.68C6.63 5.36 5 7.92 5 11v5l-2 2v1h18v-1l-2-2z"/>',"            </svg>","        </div>","    </div>","</div>"].join(""));var t={title:Lampa.Lang.translate("trailers_main"),url:"",component:"trailers_main",tab:"trailers"},a=Lampa.Storage.get("menu","[]").filter((function(e){return"trailers_main"!==e.component}));a.splice(1,0,t),Lampa.Storage.set("menu",a),Lampa.Listener.follow("app",(function(e){"ready"===e.type&&setTimeout((function(){Lampa.Storage.get("trailers_start",!0)&&(Lampa.Storage.set("trailers_start",!1),Lampa.Activity.push({url:"",title:Lampa.Lang.translate("trailers_main"),component:"trailers_main",page:1}))}),1e3)}))}}()})()})();