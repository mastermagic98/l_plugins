(()=>{var t={430:()=>{}},e={};function a(i){var r=e[i];if(void 0!==r)return r.exports;var n=e[i]={exports:{}};return t[i](n,n.exports,a),n.exports}a.d=(t,e)=>{for(var i in e)a.o(e,i)&&!a.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},a.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),a.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},(()=>{"use strict";var t={};a.r(t),a.d(t,{y:()=>s});var e=a(430);function i(t){if(!t)return"-";var e=new Date(t);return String(e.getDate()).padStart(2,"0")+"."+String(e.getMonth()+1).padStart(2,"0")+"."+e.getFullYear()}function r(t,a){this.build=function(){if(this.card=Lampa.Template.get("trailer",t),this.img=this.card.find("img")[0],this.is_youtube="rating"===a.type,this.rating=t.vote_average?t.vote_average.toFixed(1):"-",this.trailer_lang="",this.release_date="-",this.is_youtube)this.card.find(".card__title").text(t.name),this.card.find(".card__details").remove();else{var e=((t.release_date||t.first_air_date||"0000")+"").slice(0,4),i=t.title||t.name||t.original_title||t.original_name;this.card.find(".card__title").text(i),this.card.find(".card__details").text(e+" - "+(t.original_title||t.original_name)),"-"!==this.rating?this.card.find(".card__view").append('<div class="card__rating">'+this.rating+"</div>"):this.card.find(".card__view").append('<div class="card__rating">-</div>'),this.card.find(".card__view").append('<div class="card__trailer-lang"></div>'),this.card.find(".card__view").append('<div class="card__release-date"></div>')}},this.cardImgBackground=function(e){return Lampa.Storage.field("background")?"poster"===Lampa.Storage.get("background_type","complex")&&window.innerWidth>790?e.backdrop_path?Lampa.Api.img(e.backdrop_path,"original"):this.is_youtube?"https://img.youtube.com/vi/"+t.id+"/hqdefault.jpg":"":e.backdrop_path?Lampa.Api.img(e.backdrop_path,"w500"):this.is_youtube?"https://img.youtube.com/vi/"+t.id+"/hqdefault.jpg":"":""},this.image=function(){var t=this;this.img.onload=function(){t.card.addClass("card--loaded")},this.img.onerror=function(){t.img.src="./img/img_broken.svg"}},this.loadTrailerInfo=function(){var r=this;this.is_youtube||this.trailer_lang||e.Api.videos(t,(function(n){var o,l=n.results?n.results.filter((function(t){return"Trailer"===t.type})):[],s=(0,e.getPreferredLanguage)(),d=l.find((function(t){return s.includes(t.iso_639_1)}))||l[0];if(r.trailer_lang=d?d.iso_639_1:"-","-"!==r.trailer_lang?r.card.find(".card__trailer-lang").text(r.trailer_lang.toUpperCase()):r.card.find(".card__trailer-lang").text("-"),"in_theaters"===a.type||"upcoming_movies"===a.type)if(t.release_details&&t.release_details.results){var p="uk"===(o=Lampa.Storage.get("language","ru"))?"UA":"ru"===o?"RU":"US",c=t.release_details.results.find((function(t){return t.iso_3166_1===p}));if(c&&c.release_dates&&c.release_dates.length){var u=c.release_dates[0].release_date;r.release_date=i(u)}else t.release_date&&(r.release_date=i(t.release_date))}else t.release_date&&(r.release_date=i(t.release_date));else"new_series_seasons"!==a.type&&"upcoming_series"!==a.type||t.release_details&&t.release_details.first_air_date&&(r.release_date=i(t.release_details.first_air_date));r.card.find(".card__release-date").text(r.release_date)}),(function(){r.trailer_lang="-",r.card.find(".card__trailer-lang").text("-"),r.card.find(".card__release-date").text("-")}))},this.play=function(e){if(e)try{if(Lampa.Manifest.app_digital>=183){var a={title:Lampa.Utils.shortText(t.title||t.name,50),id:e,youtube:!0,url:"https://www.youtube.com/watch?v="+e,icon:'<img class="size-youtube" src="https://img.youtube.com/vi/'+e+'/default.jpg" />',template:"selectbox_icon"};Lampa.Player.play(a),Lampa.Player.playlist([a])}else Lampa.YouTube.play(e)}catch(t){Lampa.Noty.show("Помилка відтворення трейлера: "+t.message)}else Lampa.Noty.show(Lampa.Lang.translate("trailers_no_trailers"))},this.create=function(){var a=this;this.build(),this.card.on("hover:focus",(function(e,i){Lampa.Background.change(a.cardImgBackground(t)),a.onFocus(e.target,t,i),a.loadTrailerInfo()})).on("hover:enter",(function(){a.is_youtube?a.play(t.id):e.Api.videos(t,(function(t){var i=(0,e.getPreferredLanguage)(),r=t.results?t.results.filter((function(t){return"Trailer"===t.type})):[],n=r.find((function(t){return i.includes(t.iso_639_1)}))||r[0];n&&n.key?("uk"===i[0]&&"uk"!==n.iso_639_1&&"en"!==n.iso_639_1?Lampa.Noty.show(Lampa.Lang.translate("trailers_no_ua_trailer")):"ru"===i[0]&&"ru"!==n.iso_639_1&&"en"!==n.iso_639_1&&Lampa.Noty.show(Lampa.Lang.translate("trailers_no_ru_trailer")),a.play(n.key)):Lampa.Noty.show(Lampa.Lang.translate("trailers_no_trailers"))}),(function(){Lampa.Noty.show(Lampa.Lang.translate("trailers_no_trailers"))}))})).on("hover:long",(function(){if(!a.is_youtube){var i=[{title:Lampa.Lang.translate("trailers_view"),view:!0}];Lampa.Loading.start((function(){e.Api.clear(),Lampa.Loading.stop()})),e.Api.videos(t,(function(r){Lampa.Loading.stop();var n=(0,e.getPreferredLanguage)(),o=r.results?r.results.filter((function(t){return"Trailer"===t.type})):[];o.length&&(i.push({title:Lampa.Lang.translate("title_trailers"),separator:!0}),o.forEach((function(t){t.key&&n.includes(t.iso_639_1)&&i.push({title:t.name||"Trailer",id:t.key,subtitle:t.iso_639_1})}))),Lampa.Select.show({title:Lampa.Lang.translate("title_action"),items:i,onSelect:function(e){Lampa.Controller.toggle("content"),e.view?Lampa.Activity.push({url:"",component:"full",id:t.id,method:t.name?"tv":"movie",card:t,source:"tmdb"}):a.play(e.id)},onBack:function(){Lampa.Controller.toggle("content")}})}),(function(){Lampa.Loading.stop(),Lampa.Noty.show(Lampa.Lang.translate("trailers_no_trailers"))}))}})),this.image(),this.loadTrailerInfo()},this.destroy=function(){this.img.onerror=null,this.img.onload=null,this.img.src="",this.card.remove(),this.card=null,this.img=null},this.visible=function(){this.visibled||("rating"===a.type?this.img.src="https://img.youtube.com/vi/"+t.id+"/hqdefault.jpg":t.backdrop_path?this.img.src=Lampa.Api.img(t.backdrop_path,"w500"):t.poster_path?this.img.src=Lampa.Api.img(t.poster_path):this.img.src="./img/img_broken.svg",this.visibled=!0)},this.render=function(){return this.card}}function n(t){var e,a,i,n,o=this,l=Lampa.Template.get("items_line",{title:t.title}),s=l.find(".items-line__body"),d=new Lampa.Scroll({horizontal:!0,step:600}),p=Lampa.Storage.field("light_version")&&window.innerWidth>=767,c=[],u=p?6:10,m=0,g=!1;function h(){if(!g){g=!0;var e=t.results.slice(m,m+u);e.length>0?(e.forEach((function(e){var a=new r(e,{type:t.type});a.create(),a.visible(),a.onFocus=function(t,e,i){if(n=t,c.indexOf(a),o.onFocus&&o.onFocus(e),d.update(a.render(),!0),c.length>0&&c.indexOf(a)===c.length-1){var r=Lampa.Lang.translate("trailers_last_movie").replace("[title]",e.title||e.name);Lampa.Noty.show(r)}},d.append(a.render()),c.push(a)})),m+=e.length,Lampa.Layer.update(),g=!1):(Lampa.Activity.push({url:t.url,title:t.title,component:"trailers_full",type:t.type,page:Math.floor(m/u)+2}),g=!1)}}this.create=function(){d.render().find(".scroll__body").addClass("items-cards"),l.find(".items-line__title").text(t.title),(a=$('<div class="items-line__more selector"><svg width="36" height="36" viewBox="0 0 24 24" fill="currentColor"><path d="M10 18h4v-2h-4v2zM3 6v2h18V6H3zm3 7h12v-2H6v2z"/></svg></div>')).css({display:"inline-block",marginLeft:"10px",cursor:"pointer",padding:"0.5em",background:"transparent",border:"none"}),a.on("hover:enter",(function(){var e=[{title:Lampa.Lang.translate("trailers_filter_today"),value:"day",selected:"day"===Lampa.Storage.get("trailers_"+t.type+"_filter","day")},{title:Lampa.Lang.translate("trailers_filter_week"),value:"week",selected:"week"===Lampa.Storage.get("trailers_"+t.type+"_filter","day")},{title:Lampa.Lang.translate("trailers_filter_month"),value:"month",selected:"month"===Lampa.Storage.get("trailers_"+t.type+"_filter","day")},{title:Lampa.Lang.translate("trailers_filter_year"),value:"year",selected:"year"===Lampa.Storage.get("trailers_"+t.type+"_filter","day")}];Lampa.Select.show({title:Lampa.Lang.translate("trailers_filter"),items:e,onSelect:function(e){Lampa.Storage.set("trailer_category_cache_"+t.type,null),categoryCache[t.type]=null,Lampa.Storage.set("trailers_"+t.type+"_filter",e.value),Lampa.Activity.push({url:"day"===e.value||"week"===e.value?"/discover/"+(t.type.includes("movie")?"movie":"tv")+"?sort_by=popularity.desc":"month"===e.value?"/discover/"+(t.type.includes("movie")?"movie":"tv")+"?sort_by=popularity.desc&release_date.gte="+getFormattedDate(30):"/discover/"+(t.type.includes("movie")?"movie":"tv")+"?sort_by=popularity.desc&release_date.gte="+getFormattedDate(365),title:t.title,component:"trailers_main",type:t.type,page:1})},onBack:function(){Lampa.Controller.toggle("content")}})})),(i=$('<div class="items-line__more selector">'+Lampa.Lang.translate("trailers_more")+"</div>")).on("hover:enter",(function(){Lampa.Activity.push({url:t.url,title:t.title,component:"trailers_full",type:t.type,page:Math.floor(m/u)+2})})),l.find(".items-line__title").after(a),a.after(i),this.bind(),s.append(d.render());var e,r,n=(e=function(){d.isEnd()&&!g&&h()},function(){var t=this,a=arguments;clearTimeout(r),r=setTimeout((function(){e.apply(t,a)}),200)});d.render().on("scroll",n)},this.bind=function(){h(),this.more(),Lampa.Layer.update()},this.cardImgBackground=function(t){return Lampa.Storage.field("background")?"poster"===Lampa.Storage.get("background_type","complex")&&window.innerWidth>790?t.backdrop_path?Lampa.Api.img(t.backdrop_path,"original"):"":t.backdrop_path?Lampa.Api.img(t.backdrop_path,"w500"):"":""},this.more=function(){(e=Lampa.Template.get("more")).addClass("more--trailers"),e.on("hover:enter",(function(){Lampa.Activity.push({url:t.url,title:t.title,component:"trailers_full",type:t.type,page:Math.floor(m/u)+2})})),e.on("hover:focus",(function(t){n=t.target,d.update(e,!0)})),d.append(e)},this.toggle=function(){var t=this;Lampa.Controller.add("items_line",{toggle:function(){Lampa.Controller.collectionSet(d.render()),Lampa.Controller.collectionFocus(!!c.length&&n,d.render()),n&&c.length&&d.update($(n),!0)},right:function(){Navigator.canmove("right")&&(Navigator.move("right"),n&&c.length&&d.update($(n),!0)),Lampa.Controller.enable("items_line")},left:function(){Navigator.canmove("left")?(Navigator.move("left"),n&&c.length&&d.update($(n),!0)):t.onLeft?t.onLeft():Lampa.Controller.toggle("menu")},down:this.onDown,up:this.onUp,gone:function(){},back:this.onBack}),Lampa.Controller.toggle("items_line")},this.render=function(){return l},this.destroy=function(){Lampa.Arrays.destroy(c),d.destroy(),l.remove(),e&&e.remove(),a&&a.remove(),i&&i.remove(),c=[]}}function o(t){var a=new Lampa.Scroll({mask:!0,over:!0,scroll_by_item:!0}),i=[],r=$("<div></div>"),o=0,l=Lampa.Storage.field("light_version")&&window.innerWidth>=767;this.create=function(){return e.Api.main(this.build.bind(this),this.empty.bind(this)),this.render()},this.empty=function(){var t=new Lampa.Empty;r.append(t.render()),this.start=t.start,this.activity.loader(!1),this.activity.toggle()},this.build=function(t){var e=this;a.minus(),r.append(a.render()),t.forEach(this.append.bind(this)),l&&(a.onWheel=function(t){t>0?e.down():e.up()}),this.activity.loader(!1),this.activity.toggle()},this.append=function(t){var e=new n(t);e.create(),e.onDown=this.down.bind(this),e.onUp=this.up.bind(this),e.onBack=this.back.bind(this),e.onToggle=function(){o=i.indexOf(e)},e.wrap=$("<div></div>"),l?a.append(e.wrap):a.append(e.render()),i.push(e)},this.back=function(){Lampa.Activity.backward()},this.detach=function(){l&&(i.forEach((function(t){t.render().detach()})),i.slice(o,o+2).forEach((function(t){t.wrap.append(t.render())})))},this.down=function(){o++,o=Math.min(o,i.length-1),this.detach(),i[o].toggle(),a.update(i[o].render())},this.up=function(){--o<0?(o=0,this.detach(),Lampa.Controller.toggle("head")):(this.detach(),i[o].toggle()),a.update(i[o].render())},this.start=function(){var t=this;Lampa.Activity.active().activity===this.activity&&(Lampa.Controller.add("content",{toggle:function(){i.length&&(t.detach(),i[o].toggle())},left:function(){Navigator.canmove("left")?Navigator.move("left"):Lampa.Controller.toggle("menu")},right:function(){Navigator.move("right")},up:function(){Navigator.canmove("up")?Navigator.move("up"):Lampa.Controller.toggle("head")},down:function(){Navigator.canmove("down")&&Navigator.move("down")},back:this.back}),Lampa.Controller.toggle("content"))},this.pause=function(){},this.stop=function(){},this.render=function(){return r},this.destroy=function(){Lampa.Arrays.destroy(i),a.destroy(),r.remove(),i=[]}}function l(t){var a,i=new Lampa.Scroll({mask:!0,over:!0,step:250,end_ratio:2}),n=[],o=$("<div></div>"),l=$('<div class="category-full category-full--trailers"></div>'),s=Lampa.Manifest.app_digital>=166,d=!s&&Lampa.Storage.field("light_version")&&window.innerWidth>=767,p=0,c=!1;this.create=function(){return e.Api.full(t,this.build.bind(this),this.empty.bind(this)),this.render()},this.empty=function(){var t=new Lampa.Empty;i.append(t.render()),this.start=t.start,this.activity.loader(!1),this.activity.toggle()},this.next=function(){var a=this;c||(t.page<p&&t.page<30?(c=!0,t.page++,e.Api.full(t,(function(t){t.results&&t.results.length?a.append(t,!0):Lampa.Noty.show(Lampa.Lang.translate("trailers_no_trailers")),c=!1}),(function(){Lampa.Noty.show(Lampa.Lang.translate("trailers_no_trailers")),c=!1}))):Lampa.Noty.show(Lampa.Lang.translate("trailers_no_more_data")))},this.cardImgBackground=function(t){return Lampa.Storage.field("background")?"poster"===Lampa.Storage.get("background_type","complex")&&window.innerWidth>790?t.backdrop_path?Lampa.Api.img(t.backdrop_path,"original"):"":t.backdrop_path?Lampa.Api.img(t.backdrop_path,"w500"):"":""},this.append=function(e,o){var p=this;o||l.empty(),e.results.forEach((function(e){var o=new r(e,{type:t.type});o.create(),o.visible(),o.onFocus=function(t,e){if(a=t,i.update(o.render(),!0),d||s||!i.isEnd()||p.next(),n.length>0&&n.indexOf(o)===n.length-1){var r=Lampa.Lang.translate("trailers_last_movie").replace("[title]",e.title||e.name);Lampa.Noty.show(r)}},l.append(o.render()),n.push(o)}));var c=e.results.length;if(c<20)for(var u=c;u<20;u++){var m=$('<div class="card card--placeholder" style="width: 33.3%; margin-bottom: 1.5em; visibility: hidden;"></div>');l.append(m)}},this.build=function(t){var e=this;if(t.results&&t.results.length){if(p=t.total_pages||1,i.minus(),o.append(i.render()),this.append(t),d&&n.length&&this.back(),p>t.page&&n.length&&this.more(),i.append(l),s){i.onEnd=this.next.bind(this),i.onWheel=function(t){Lampa.Controller.own(e)||e.start(),t>0&&Navigator.move("down")}.bind(this);var a=debounce((function(){i.isEnd()&&!c&&e.next()}),100);i.render().on("scroll",a)}this.activity.loader(!1),this.activity.toggle()}else o.append(i.render()),this.empty()},this.more=function(){var e=$('<div class="selector" style="width: 100%; height: 5px"></div>');e.on("hover:enter",(function(){var e=Lampa.Arrays.clone(t);delete e.activity,e.page=(e.page||1)+1,Lampa.Activity.push({url:e.url,title:t.title||Lampa.Lang.translate("title_trailers"),component:"trailers_full",type:e.type,page:e.page})})),l.append(e)},this.back=function(){a=n[0].render()[0];var e=$('<div class="selector" style="width: 100%; height: 5px"></div>');e.on("hover:enter",(function(){t.page>1?Lampa.Activity.backward():Lampa.Controller.toggle("head")})),l.prepend(e)},this.start=function(){Lampa.Activity.active().activity===this.activity&&(Lampa.Controller.add("content",{link:this,toggle:function(){Lampa.Controller.collectionSet(i.render()),Lampa.Controller.collectionFocus(a||!1,i.render())},left:function(){Navigator.canmove("left")?Navigator.move("left"):Lampa.Controller.toggle("menu")},right:function(){Navigator.move("right")},up:function(){Navigator.canmove("up")?Navigator.move("up"):Lampa.Controller.toggle("head")},down:function(){Navigator.canmove("down")&&Navigator.move("down")},back:function(){Lampa.Activity.backward()}}),Lampa.Controller.toggle("content"))},this.pause=function(){},this.stop=function(){},this.render=function(){return o},this.destroy=function(){Lampa.Arrays.destroy(n),i.destroy(),o.remove(),l.remove(),n=[]}}function s(){Lampa.Template.add("trailer",['<div class="card card--trailer selector">','    <div class="card__view">','        <img class="card__img" />',"    </div>",'    <div class="card__info">','        <div class="card__title"></div>','        <div class="card__details"></div>',"    </div>","</div>"].join("")),Lampa.Template.add("items_line",['<div class="items-line">','    <div class="items-line__header">','        <div class="items-line__title"></div>',"    </div>",'    <div class="items-line__body"></div>',"</div>"].join("")),Lampa.Template.add("more",['<div class="card card--more selector">','    <div class="card__view">','        <div class="card__more">','            <svg width="36" height="36" viewBox="0 0 24 24" fill="currentColor">','                <path d="M12 22c1.1 0 2-.9 2-2h-4c0 1.1.9 2 2 2zm6-6v-5c0-3.07-1.63-5.64-4.5-6.32V4c0-1.1-.9-2-2-2s-2 .9-2 2v.68C6.63 5.36 5 7.92 5 11v5l-2 2v1h18v-1l-2-2z"/>',"            </svg>","        </div>","    </div>","</div>"].join(""))}function d(){var a;window.plugin_trailers_ready||(window.plugin_trailers_ready=!0,Lampa.Lang.add(t.translations),Lampa.Component.add("trailers_main",o),Lampa.Component.add("trailers_full",l),s(),Lampa.TMDB&&Lampa.TMDB.key()?((a=$('<li class="menu__item selector"><div class="menu__ico"><svg height="70" viewBox="0 0 80 70" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M71.2555 2.08955C74.6975 3.2397 77.4083 6.62804 78.3283 10.9306C80 18.7291 80 35 80 35C80 35 80 51.2709 78.3283 59.0694C77.4083 63.372 74.6975 66.7603 71.2555 67.9104C65.0167 70 40 70 40 70C40 70 14.9833 70 8.74453 67.9104C5.3025 66.7603 2.59172 63.372 1.67172 59.0694C0 51.2709 0 35 0 35C0 35 0 18.7291 1.67172 10.9306C2.59172 6.62804 5.3025 3.2395 8.74453 2.08955C14.9833 0 40 0 40 0C40 0 65.0167 0 71.2555 2.08955ZM55.5909 35.0004L29.9773 49.5714V20.4286L55.5909 35.0004Z" fill="currentColor"/></svg></div><div class="menu__text">'+Lampa.Lang.translate("title_trailers")+"</div></li>")).on("hover:enter",(function(){Lampa.Activity.push({url:"",title:Lampa.Lang.translate("title_trailers"),component:"trailers_main",page:1})})),$(".menu .menu__list").eq(0).append(a),$("body").append(Lampa.Template.get("trailer_style",{},!0)),Lampa.Storage.listener.follow("change",(function(t){"language"===t.name&&e.Api.clear()}))):Lampa.Noty.show("TMDB API key is missing. Trailers plugin cannot be loaded."))}window.appready?d():Lampa.Listener.follow("app",(function(t){"ready"===t.type&&d()}))})()})();