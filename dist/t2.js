function getFormattedDate(e){var t=new Date;return e&&t.setDate(t.getDate()-e),t.getFullYear()+"-"+String(t.getMonth()+1).padStart(2,"0")+"-"+String(t.getDate()).padStart(2,"0")}function formatDateToDDMMYYYY(e){if(!e)return"-";var t=new Date(e);return String(t.getDate()).padStart(2,"0")+"."+String(t.getMonth()+1).padStart(2,"0")+"."+t.getFullYear()}function getRegion(){var e=Lampa.Storage.get("language","ru");return"uk"===e?"UA":"ru"===e?"RU":"US"}function getInterfaceLanguage(){return Lampa.Storage.get("language","ru")}function getPreferredLanguage(){var e=Lampa.Storage.get("language","ru");return"uk"===e?["uk","en"]:"ru"===e?["ru","en"]:["en"]}var e=new Lampa.Reguest,t=Lampa.TMDB.key(),a="https://api.themoviedb.org/3",r={},i={};const s=864e5;function clearExpiredCache(){for(var e in console.log("Clearing expired cache"),r)r[e].timestamp&&Date.now()-r[e].timestamp>s&&delete r[e];for(var e in i)i[e].timestamp&&Date.now()-i[e].timestamp>s&&(delete i[e],Lampa.Storage.set("trailer_category_cache_"+e,null))}function get(r,i,s,n){var l=a+r+"&api_key="+t+"&page="+i+"&language="+getInterfaceLanguage();e.silent(l,s,n)}function getLocalMoviesInTheaters(r,i,s){var n=getRegion(),l=getInterfaceLanguage(),o=new Date,u=new Date(o.getTime()-3888e6).toISOString().split("T")[0],c=`${a}/movie/now_playing?api_key=${t}&language=${l}&page=${r}&region=${n}&primary_release_date.gte=${u}`;e.silent(c,(function(r){if(r.results&&r.results.length){var s=r.results.length,l=0;function finalizeResults(){var e=r.results.filter((function(e){if(e.release_details&&e.release_details.results){var t=e.release_details.results.find((function(e){return e.iso_3166_1===n}));if(t&&t.release_dates&&t.release_dates.length){var a=new Date(t.release_dates[0].release_date);return a>=new Date(u)&&a<=o}}if(e.release_date){var r=new Date(e.release_date);return r>=new Date(u)&&r<=o}return!1}));e.sort((function(e,t){var a=e.release_details?.results?.find((function(e){return e.iso_3166_1===n}))?.release_dates[0]?.release_date||e.release_date,r=t.release_details?.results?.find((function(e){return e.iso_3166_1===n}))?.release_dates[0]?.release_date||t.release_date;return new Date(r)-new Date(a)})),r.results=e,i(r)}r.results.forEach((function(r){var i=r.id;if(i){var n=`${a}/movie/${i}/release_dates?api_key=${t}`;e.silent(n,(function(e){r.release_details=e,++l===s&&finalizeResults()}),(function(){r.release_details={results:[]},++l===s&&finalizeResults()}))}else r.release_details={results:[]},++l===s&&finalizeResults()}))}else i(r)}),s)}function getUpcomingMovies(r,i,s){var n=getRegion(),l=getFormattedDate(0),o=getFormattedDate(-180),u=getInterfaceLanguage(),c=`${a}/discover/movie?api_key=${t}&language=${u}&page=${r}&region=${n}&primary_release_date.gte=${l}&primary_release_date.lte=${o}&sort_by=popularity.desc&vote_count.gte=1`;e.silent(c,(function(r){if(r.results&&r.results.length){var s=r.results.length,l=0;function finalizeResults(){var e=r.results.filter((function(e){if(e.release_details&&e.release_details.results){var t=e.release_details.results.find((function(e){return e.iso_3166_1===n}));if(t&&t.release_dates&&t.release_dates.length)return!0}return!!e.release_date}));e.sort((function(e,t){var a=e.release_details?.results?.find((function(e){return e.iso_3166_1===n}))?.release_dates[0]?.release_date||e.release_date,r=t.release_details?.results?.find((function(e){return e.iso_3166_1===n}))?.release_dates[0]?.release_date||t.release_date;return new Date(a)-new Date(r)})),r.results=e,i(r)}r.results.forEach((function(r){var i=r.id;if(i){var n=`${a}/movie/${i}/release_dates?api_key=${t}`;e.silent(n,(function(e){r.release_details=e,++l===s&&finalizeResults()}),(function(){r.release_details={results:[]},++l===s&&finalizeResults()}))}else r.release_details={results:[]},++l===s&&finalizeResults()}))}else i(r)}),s)}const n={get,getLocalMoviesInTheaters,getUpcomingMovies,main:function main(e,t){var a=new Lampa.Status(6);a.onComplite=function(){var r=[];["popular_movies","in_theaters","upcoming_movies","popular_series","new_series_seasons","upcoming_series"].forEach((function(e){a.data[e]&&a.data[e].results&&a.data[e].results.length&&(i[e]={results:a.data[e].results,timestamp:Date.now()},Lampa.Storage.set("trailer_category_cache_"+e,i[e]),r.push(a.data[e]))})),r.length?e(r):t()};var append=function(e,t,r,i){i.title=e,i.type=t,i.url=r,a.append(t,i)},r=getFormattedDate(0),s=getFormattedDate(-180),n=getFormattedDate(90),l=getFormattedDate(-90);get("/discover/movie?sort_by=popularity.desc&vote_count.gte=1",1,(function(e){append(Lampa.Lang.translate("trailers_popular_movies"),"popular_movies","/discover/movie?sort_by=popularity.desc",{results:e.results||[]})}),(function(){append(Lampa.Lang.translate("trailers_popular_movies"),"popular_movies","/discover/movie?sort_by=popularity.desc",{results:[]})})),getLocalMoviesInTheaters(1,(function(e){append(Lampa.Lang.translate("trailers_in_theaters"),"in_theaters","/movie/now_playing",{results:e.results||[]})}),(function(){append(Lampa.Lang.translate("trailers_in_theaters"),"in_theaters","/movie/now_playing",{results:[]})})),getUpcomingMovies(1,(function(e){append(Lampa.Lang.translate("trailers_upcoming_movies"),"upcoming_movies","/discover/movie?primary_release_date.gte="+r+"&primary_release_date.lte="+s+"&sort_by=popularity.desc",{results:e.results||[]})}),(function(){append(Lampa.Lang.translate("trailers_upcoming_movies"),"upcoming_movies","/discover/movie?primary_release_date.gte="+r+"&primary_release_date.lte="+s+"&sort_by=popularity.desc",{results:[]})})),get("/discover/tv?sort_by=popularity.desc&vote_count.gte=1",1,(function(e){var t=e.results?e.results.filter((function(e){return!e.genre_ids.includes(99)&&!e.genre_ids.includes(10763)&&!e.genre_ids.includes(10764)})):[];append(Lampa.Lang.translate("trailers_popular_series"),"popular_series","/discover/tv?sort_by=popularity.desc",{results:t})}),(function(){append(Lampa.Lang.translate("trailers_popular_series"),"popular_series","/discover/tv?sort_by=popularity.desc",{results:[]})})),get("/discover/tv?air_date.gte="+n+"&air_date.lte="+l+"&sort_by=popularity.desc&vote_count.gte=1",1,(function(e){e.results&&e.results.forEach((function(e){e.release_details={first_air_date:e.first_air_date}})),append(Lampa.Lang.translate("trailers_new_series_seasons"),"new_series_seasons","/discover/tv?air_date.gte="+n+"&air_date.lte="+l+"&sort_by=popularity.desc",{results:e.results||[]})}),(function(){append(Lampa.Lang.translate("trailers_new_series_seasons"),"new_series_seasons","/discover/tv?air_date.gte="+n+"&air_date.lte="+l+"&sort_by=popularity.desc",{results:[]})})),get("/discover/tv?first_air_date.gte="+r+"&first_air_date.lte="+s+"&sort_by=popularity.desc&vote_count.gte=1",1,(function(e){e.results&&e.results.forEach((function(e){e.release_details={first_air_date:e.first_air_date}})),append(Lampa.Lang.translate("trailers_upcoming_series"),"upcoming_series","/discover/tv?first_air_date.gte="+r+"&first_air_date.lte="+s+"&sort_by=popularity.desc",{results:e.results||[]})}),(function(){append(Lampa.Lang.translate("trailers_upcoming_series"),"upcoming_series","/discover/tv?first_air_date.gte="+r+"&first_air_date.lte="+s+"&sort_by=popularity.desc",{results:[]})}))},full:function full(e,t,a){if(clearExpiredCache(),"in_theaters"===e.type){var r=getRegion(),s=new Date,n=new Date(s.getTime()-3888e6).toISOString().split("T")[0],l=20,o=[],u=new Set,c=1,d=0;if((L=i.in_theaters||Lampa.Storage.get("trailer_category_cache_in_theaters",null))&&L.results&&L.results.length>0){o=L.results;var g=(e.page-1)*l,_=Math.min(e.page*l,o.length),p=o.slice(g,_),m={dates:{maximum:s.toISOString().split("T")[0],minimum:n},page:e.page,results:p,total_pages:Math.ceil(o.length/l)||1,total_results:o.length};if(o.length>=g+1&&p.length>0)return void t(m);c=Math.ceil(o.length/l)+1}function fetchNextPage(){u.has(c)||c>30||d&&c>d?finalizeResults():(u.add(c),getLocalMoviesInTheaters(c,(function(t){if(t&&t.results&&t.results.length){o=o.concat(t.results),1===c&&(d=t.total_pages||30);var a=(e.page-1)*l;Math.min(e.page*l,o.length);o.length>=a+1||c>=d||c>=30?finalizeResults():(c++,fetchNextPage())}else c<d&&c<30?(c++,fetchNextPage()):finalizeResults()}),a))}function finalizeResults(){var a=[...new Set(o.map(JSON.stringify))].map(JSON.parse);a.sort((function(e,t){var a=e.release_details?.results?.find((function(e){return e.iso_3166_1===r}))?.release_dates[0]?.release_date||e.release_date,i=t.release_details?.results?.find((function(e){return e.iso_3166_1===r}))?.release_dates[0]?.release_date||t.release_date;return new Date(i)-new Date(a)}));var u=(e.page-1)*l,c=Math.min(e.page*l,a.length),d=a.slice(u,c),g={dates:{maximum:s.toISOString().split("T")[0],minimum:n},page:e.page,results:d.length>0?d:a.slice(0,l),total_pages:Math.ceil(a.length/l)||1,total_results:a.length};i.in_theaters={results:a,timestamp:Date.now()},Lampa.Storage.set("trailer_category_cache_in_theaters",i.in_theaters),t(g)}fetchNextPage()}else if("upcoming_movies"===e.type){s=getFormattedDate(0);var h=getFormattedDate(-180);l=20;if((L=i.upcoming_movies||Lampa.Storage.get("trailer_category_cache_upcoming_movies",null))&&L.results&&L.results.length>0){var f=L.results.filter((function(e){if(e.release_details&&e.release_details.results){var t=e.release_details.results.find((function(e){return e.iso_3166_1===getRegion()}));if(t&&t.release_dates&&t.release_dates.length)return!0}return!!e.release_date}));g=(e.page-1)*l,_=Math.min(e.page*l,f.length),p=f.slice(g,_),m={page:e.page,results:p,total_pages:Math.ceil(f.length/l)||1,total_results:f.length};if(p.length>0)return void t(m)}getUpcomingMovies(e.page,(function(r){if(r&&r.results&&r.results.length){var s=r.results.filter((function(e){if(e.release_details&&e.release_details.results){var t=e.release_details.results.find((function(e){return e.iso_3166_1===getRegion()}));if(t&&t.release_dates&&t.release_dates.length)return!0}return!!e.release_date}));if(r.results=s,r.total_results=s.length,r.total_pages=Math.ceil(s.length/l)||1,1===e.page)i.upcoming_movies={results:s,timestamp:Date.now()},Lampa.Storage.set("trailer_category_cache_upcoming_movies",i.upcoming_movies);else{var n=i.upcoming_movies||Lampa.Storage.get("trailer_category_cache_upcoming_movies",{results:[]});n.results=n.results.concat(s),n.results=[...new Set(n.results.map(JSON.stringify))].map(JSON.parse),i.upcoming_movies=n,Lampa.Storage.set("trailer_category_cache_upcoming_movies",n)}t(r)}else a()}),a)}else if("new_series_seasons"===e.type){var v=getFormattedDate(90),y=getFormattedDate(-90);if((L=i.new_series_seasons||Lampa.Storage.get("trailer_category_cache_new_series_seasons",null))&&L.results){l=20,g=(e.page-1)*l,_=e.page*l;if((m={page:e.page,results:L.results.slice(g,_),total_pages:Math.ceil(L.results.length/l),total_results:L.results.length}).results.length>0)return void t(m)}get("/discover/tv?air_date.gte="+v+"&air_date.lte="+y+"&sort_by=popularity.desc&vote_count.gte=1",e.page,(function(r){if(r&&r.results&&r.results.length){if(r.results.forEach((function(e){e.release_details={first_air_date:e.first_air_date}})),1===e.page)i.new_series_seasons={results:r.results,timestamp:Date.now()},Lampa.Storage.set("trailer_category_cache_new_series_seasons",i.new_series_seasons);else{var s=i.new_series_seasons||Lampa.Storage.get("trailer_category_cache_new_series_seasons",{results:[]});s.results=s.results.concat(r.results),i.new_series_seasons=s,Lampa.Storage.set("trailer_category_cache_new_series_seasons",s)}t(r)}else a()}),a)}else if("upcoming_series"===e.type){s=getFormattedDate(0),h=getFormattedDate(-180);if((L=i.upcoming_series||Lampa.Storage.get("trailer_category_cache_upcoming_series",null))&&L.results){l=20,g=(e.page-1)*l,_=e.page*l;if((m={page:e.page,results:L.results.slice(g,_),total_pages:Math.ceil(L.results.length/l),total_results:L.results.length}).results.length>0)return void t(m)}get("/discover/tv?first_air_date.gte="+s+"&first_air_date.lte="+h+"&sort_by=popularity.desc&vote_count.gte=1",e.page,(function(r){if(r&&r.results&&r.results.length){if(r.results.forEach((function(e){e.release_details={first_air_date:e.first_air_date}})),1===e.page)i.upcoming_series={results:r.results,timestamp:Date.now()},Lampa.Storage.set("trailer_category_cache_upcoming_series",i.upcoming_series);else{var s=i.upcoming_series||Lampa.Storage.get("trailer_category_cache_upcoming_series",{results:[]});s.results=s.results.concat(r.results),i.upcoming_series=s,Lampa.Storage.set("trailer_category_cache_upcoming_series",s)}t(r)}else a()}),a)}else{var L;if((L=i[e.type]||Lampa.Storage.get("trailer_category_cache_"+e.type,null))&&L.results){l=20,g=(e.page-1)*l,_=e.page*l;if((m={page:e.page,results:L.results.slice(g,_),total_pages:Math.ceil(L.results.length/l),total_results:L.results.length}).results.length>0)return void t(m)}get(e.url,e.page,(function(r){if(r&&r.results&&r.results.length){if(1===e.page)i[e.type]={results:r.results,timestamp:Date.now()},Lampa.Storage.set("trailer_category_cache_"+e.type,i[e.type]);else{var s=i[e.type]||Lampa.Storage.get("trailer_category_cache_"+e.type,{results:[]});s.results=s.results.concat(r.results),i[e.type]=s,Lampa.Storage.set("trailer_category_cache_"+e.type,s)}t(r)}else a()}),a)}},videos:function videos(i,n,l){clearExpiredCache();var o=i.name?"tv":"movie",u=i.id,c=o+"_"+u;if(r[c]&&r[c].timestamp&&Date.now()-r[c].timestamp<s)n(r[c]);else{var d=a+"/"+o+"/"+u+"/videos?api_key="+t,g=getPreferredLanguage(),_=0,p=g.length+1,m=[];!function tryFetch(t){if(_>=p){var a=m.find((function(e){return"en"===e.iso_639_1}));a?(r[c]={id:u,results:[a],timestamp:Date.now()},n({id:u,results:[a]})):(r[c]={id:u,results:[],timestamp:Date.now()},l())}else{var i=d;t<g.length&&(i+="&language="+g[t]),e.silent(i,(function(e){var a=e.results?e.results.filter((function(e){return"Trailer"===e.type})):[];m=m.concat(a);var i=a.find((function(e){return g.includes(e.iso_639_1)}));i?(r[c]={id:u,results:[i],timestamp:Date.now()},n({id:u,results:[i]})):(_++,tryFetch(t+1))}),(function(){_++,tryFetch(t+1)}))}}(0)}},clear:function clear(){e.clear(),r={},i={},["popular_movies","in_theaters","upcoming_movies","popular_series","new_series_seasons","upcoming_series"].forEach((function(e){Lampa.Storage.set("trailer_category_cache_"+e,null)}))}};function Trailer(e,t){this.build=function(){if(this.card=Lampa.Template.get("trailer",e),this.img=this.card.find("img")[0],this.is_youtube="rating"===t.type,this.rating=e.vote_average?e.vote_average.toFixed(1):"-",this.trailer_lang="",this.release_date="-",this.is_youtube)this.card.find(".card__title").text(e.name),this.card.find(".card__details").remove();else{var a=((e.release_date||e.first_air_date||"0000")+"").slice(0,4),r=e.title||e.name||e.original_title||e.original_name;this.card.find(".card__title").text(r),this.card.find(".card__details").text(a+" - "+(e.original_title||e.original_name)),"-"!==this.rating?this.card.find(".card__view").append('<div class="card__rating">'+this.rating+"</div>"):this.card.find(".card__view").append('<div class="card__rating">-</div>'),this.card.find(".card__view").append('<div class="card__trailer-lang"></div>'),this.card.find(".card__view").append('<div class="card__release-date"></div>')}},this.cardImgBackground=function(t){return Lampa.Storage.field("background")?"poster"===Lampa.Storage.get("background_type","complex")&&window.innerWidth>790?t.backdrop_path?Lampa.Api.img(t.backdrop_path,"original"):this.is_youtube?"https://img.youtube.com/vi/"+e.id+"/hqdefault.jpg":"":t.backdrop_path?Lampa.Api.img(t.backdrop_path,"w500"):this.is_youtube?"https://img.youtube.com/vi/"+e.id+"/hqdefault.jpg":"":""},this.image=function(){var e=this;this.img.onload=function(){e.card.addClass("card--loaded")},this.img.onerror=function(){e.img.src="./img/img_broken.svg"}},this.loadTrailerInfo=function(){var a=this;this.is_youtube||this.trailer_lang||n.videos(e,(function(r){var i=r.results?r.results.filter((function(e){return"Trailer"===e.type})):[],s=getPreferredLanguage(),n=i.find((function(e){return s.includes(e.iso_639_1)}))||i[0];if(a.trailer_lang=n?n.iso_639_1:"-","-"!==a.trailer_lang?a.card.find(".card__trailer-lang").text(a.trailer_lang.toUpperCase()):a.card.find(".card__trailer-lang").text("-"),"in_theaters"===t.type||"upcoming_movies"===t.type)if(e.release_details&&e.release_details.results){var l=getRegion(),o=e.release_details.results.find((function(e){return e.iso_3166_1===l}));if(o&&o.release_dates&&o.release_dates.length){var u=o.release_dates[0].release_date;a.release_date=formatDateToDDMMYYYY(u)}else e.release_date&&(a.release_date=formatDateToDDMMYYYY(e.release_date))}else e.release_date&&(a.release_date=formatDateToDDMMYYYY(e.release_date));else"new_series_seasons"!==t.type&&"upcoming_series"!==t.type||e.release_details&&e.release_details.first_air_date&&(a.release_date=formatDateToDDMMYYYY(e.release_details.first_air_date));a.card.find(".card__release-date").text(a.release_date)}),(function(){a.trailer_lang="-",a.card.find(".card__trailer-lang").text("-"),a.card.find(".card__release-date").text("-")}))},this.play=function(t){if(t)try{if(Lampa.Manifest.app_digital>=183){var a={title:Lampa.Utils.shortText(e.title||e.name,50),id:t,youtube:!0,url:"https://www.youtube.com/watch?v="+t,icon:'<img class="size-youtube" src="https://img.youtube.com/vi/'+t+'/default.jpg" />',template:"selectbox_icon"};Lampa.Player.play(a),Lampa.Player.playlist([a])}else Lampa.YouTube.play(t)}catch(e){Lampa.Noty.show("Помилка відтворення трейлера: "+e.message)}else Lampa.Noty.show(Lampa.Lang.translate("trailers_no_trailers"))},this.create=function(){var t=this;this.build(),this.is_youtube?(this.card.on("hover:focus",(function(a,r){Lampa.Background.change(t.cardImgBackground(e)),t.onFocus(a.target,e,r)})).on("hover:enter",(function(){t.play(e.id)})),this.image()):n.videos(e,(function(a){var r=a.results?a.results.filter((function(e){return"Trailer"===e.type})):[];0!==r.length?(t.card.on("hover:focus",(function(a,r){Lampa.Background.change(t.cardImgBackground(e)),t.onFocus(a.target,e,r),t.loadTrailerInfo()})).on("hover:enter",(function(){var e=getPreferredLanguage(),a=r.find((function(t){return e.includes(t.iso_639_1)}))||r[0];a&&a.key?("uk"===e[0]&&"uk"!==a.iso_639_1&&"en"!==a.iso_639_1?Lampa.Noty.show(Lampa.Lang.translate("trailers_no_ua_trailer")):"ru"===e[0]&&"ru"!==a.iso_639_1&&"en"!==a.iso_639_1&&Lampa.Noty.show(Lampa.Lang.translate("trailers_no_ru_trailer")),t.play(a.key)):Lampa.Noty.show(Lampa.Lang.translate("trailers_no_trailers"))})).on("hover:long",(function(){var a=[{title:Lampa.Lang.translate("trailers_view"),view:!0}];Lampa.Loading.start((function(){n.clear(),Lampa.Loading.stop()})),a.push({title:Lampa.Lang.translate("title_trailers"),separator:!0}),r.forEach((function(e){e.key&&getPreferredLanguage().includes(e.iso_639_1)&&a.push({title:e.name||"Trailer",id:e.key,subtitle:e.iso_639_1})})),Lampa.Select.show({title:Lampa.Lang.translate("title_action"),items:a,onSelect:function onSelect(a){Lampa.Controller.toggle("content"),a.view?Lampa.Activity.push({url:"",component:"full",id:e.id,method:e.name?"tv":"movie",card:e,source:"tmdb"}):t.play(a.id)},onBack:function onBack(){Lampa.Controller.toggle("content")}})})),t.image(),t.loadTrailerInfo()):t.card=null}),(function(){t.card=null}))},this.destroy=function(){this.img&&(this.img.onerror=null,this.img.onload=null,this.img.src=""),this.card&&(this.card.remove(),this.card=null),this.img=null},this.visible=function(){!this.visibled&&this.card&&("rating"===t.type?this.img.src="https://img.youtube.com/vi/"+e.id+"/hqdefault.jpg":e.backdrop_path?this.img.src=Lampa.Api.img(e.backdrop_path,"w500"):e.poster_path?this.img.src=Lampa.Api.img(e.poster_path):this.img.src="./img/img_broken.svg",this.visibled=!0)},this.render=function(){return this.card||$("<div></div>")}}function Line(e){console.log("Line constructor called"),this.data=e,this.cards=[],this.create=function(){console.log("Line.create called"),this.cards=[],this.data.results.forEach((e=>{const t=new Trailer(e,{type:this.data.type});t.create(),this.cards.push(t)}))},this.render=function(){console.log("Line.render called");const e=Lampa.Template.get("line",{title:this.data.title});return this.cards.forEach((t=>{const a=t.render();a&&a.length&&e.find(".line__cards").append(a)})),e},this.destroy=function(){console.log("Line.destroy called"),this.cards.forEach((e=>{e.destroy()})),this.cards=[]},this.toggle=function(){this.cards.length&&(Lampa.Controller.collectionSet(this.render()),Lampa.Controller.collectionFocus(this.cards[0].render()[0],this.render()))},this.onDown=function(){},this.onUp=function(){},this.onBack=function(){}}function Component$1(e){var t=new Lampa.Scroll({mask:!0,over:!0,scroll_by_item:!0}),a=[],r=$("<div></div>"),i=0,s=Lampa.Storage.field("light_version")&&window.innerWidth>=767;this.create=function(){return n.main(this.build.bind(this),this.empty.bind(this)),this.render()},this.empty=function(){var e=new Lampa.Empty;r.append(e.render()),this.start=e.start,this.activity.loader(!1),this.activity.toggle()},this.build=function(e){var a=this;t.minus(),r.append(t.render()),e.forEach(this.append.bind(this)),s&&(t.onWheel=function(e){e>0?a.down():a.up()}),this.activity.loader(!1),this.activity.toggle()},this.append=function(e){var r=new Line(e);r.create(),r.onDown=this.down.bind(this),r.onUp=this.up.bind(this),r.onBack=this.back.bind(this),r.onToggle=function(){i=a.indexOf(r)},r.wrap=$("<div></div>"),s?t.append(r.wrap):t.append(r.render()),a.push(r)},this.back=function(){Lampa.Activity.backward()},this.detach=function(){s&&(a.forEach((function(e){e.render().detach()})),a.slice(i,i+2).forEach((function(e){e.wrap.append(e.render())})))},this.down=function(){i++,i=Math.min(i,a.length-1),this.detach(),a[i].toggle(),t.update(a[i].render())},this.up=function(){--i<0?(i=0,this.detach(),Lampa.Controller.toggle("head")):(this.detach(),a[i].toggle()),t.update(a[i].render())},this.start=function(){var e=this;Lampa.Activity.active().activity===this.activity&&(Lampa.Controller.add("content",{toggle:function(){a.length&&(e.detach(),a[i].toggle())},left:function(){Navigator.canmove("left")?Navigator.move("left"):Lampa.Controller.toggle("menu")},right:function(){Navigator.move("right")},up:function(){Navigator.canmove("up")?Navigator.move("up"):Lampa.Controller.toggle("head")},down:function(){Navigator.canmove("down")&&Navigator.move("down")},back:this.back}),Lampa.Controller.toggle("content"))},this.pause=function(){},this.stop=function(){},this.render=function(){return r},this.destroy=function(){Lampa.Arrays.destroy(a),t.destroy(),r.remove(),a=[]}}function Component(e){var t,a=new Lampa.Scroll({mask:!0,over:!0,step:250,end_ratio:2}),r=[],i=$("<div></div>"),s=$('<div class="category-full category-full--trailers"></div>'),l=Lampa.Manifest.app_digital>=166,o=!l&&(Lampa.Storage.field("light_version")&&window.innerWidth>=767),u=0,c=!1;this.create=function(){return n.full(e,this.build.bind(this),this.empty.bind(this)),this.render()},this.empty=function(){var e=new Lampa.Empty;a.append(e.render()),this.start=e.start,this.activity.loader(!1),this.activity.toggle()},this.next=function(){var t=this;c||(e.page<u&&e.page<30?(c=!0,e.page++,n.full(e,(function(e){e.results&&e.results.length?t.append(e,!0):Lampa.Noty.show(Lampa.Lang.translate("trailers_no_trailers")),c=!1}),(function(){Lampa.Noty.show(Lampa.Lang.translate("trailers_no_trailers")),c=!1}))):Lampa.Noty.show(Lampa.Lang.translate("trailers_no_more_data")))},this.cardImgBackground=function(e){return Lampa.Storage.field("background")?"poster"===Lampa.Storage.get("background_type","complex")&&window.innerWidth>790?e.backdrop_path?Lampa.Api.img(e.backdrop_path,"original"):"":e.backdrop_path?Lampa.Api.img(e.backdrop_path,"w500"):"":""},this.append=function(i,n){var u=this;n||s.empty(),i.results.forEach((function(i){var n=new Trailer(i,{type:e.type});n.create(),n.visible(),n.onFocus=function(e,i){if(t=e,a.update(n.render(),!0),o||l||!a.isEnd()||u.next(),r.length>0&&r.indexOf(n)===r.length-1){var s=Lampa.Lang.translate("trailers_last_movie").replace("[title]",i.title||i.name);Lampa.Noty.show(s)}},s.append(n.render()),r.push(n)}));var c=i.results.length;if(c<20)for(var d=c;d<20;d++){var g=$('<div class="card card--placeholder" style="width: 33.3%; margin-bottom: 1.5em; visibility: hidden;"></div>');s.append(g)}},this.build=function(e){var t=this;if(e.results&&e.results.length){if(u=e.total_pages||1,a.minus(),i.append(a.render()),this.append(e),o&&r.length&&this.back(),u>e.page&&r.length&&this.more(),a.append(s),l){a.onEnd=this.next.bind(this),a.onWheel=function(e){Lampa.Controller.own(t)||t.start(),e>0&&Navigator.move("down")}.bind(this);var n=debounce((function(){a.isEnd()&&!c&&t.next()}),100);a.render().on("scroll",n)}this.activity.loader(!1),this.activity.toggle()}else i.append(a.render()),this.empty()},this.more=function(){var t=$('<div class="selector" style="width: 100%; height: 5px"></div>');t.on("hover:enter",(function(){var t=Lampa.Arrays.clone(e);delete t.activity,t.page=(t.page||1)+1,Lampa.Activity.push({url:t.url,title:e.title||Lampa.Lang.translate("title_trailers"),component:"trailers_full",type:t.type,page:t.page})})),s.append(t)},this.back=function(){t=r[0].render()[0];var a=$('<div class="selector" style="width: 100%; height: 5px"></div>');a.on("hover:enter",(function(){e.page>1?Lampa.Activity.backward():Lampa.Controller.toggle("head")})),s.prepend(a)},this.start=function(){Lampa.Activity.active().activity===this.activity&&(Lampa.Controller.add("content",{link:this,toggle:function(){Lampa.Controller.collectionSet(a.render()),Lampa.Controller.collectionFocus(t||!1,a.render())},left:function(){Navigator.canmove("left")?Navigator.move("left"):Lampa.Controller.toggle("menu")},right:function(){Navigator.move("right")},up:function(){Navigator.canmove("up")?Navigator.move("up"):Lampa.Controller.toggle("head")},down:function(){Navigator.canmove("down")&&Navigator.move("down")},back:function(){Lampa.Activity.backward()}}),Lampa.Controller.toggle("content"))},this.pause=function(){},this.stop=function(){},this.render=function(){return i},this.destroy=function(){Lampa.Arrays.destroy(r),a.destroy(),i.remove(),s.remove(),r=[]}}const l={trailers_popular:{ru:"Популярное",uk:"Популярне",en:"Popular"},trailers_in_theaters:{ru:"В прокате",uk:"В прокаті",en:"In Theaters"},trailers_upcoming_movies:{ru:"Ожидаемые фильмы",uk:"Очікувані фільми",en:"Upcoming Movies"},trailers_popular_series:{ru:"Популярные сериалы",uk:"Популярні серіали",en:"Popular Series"},trailers_new_series_seasons:{ru:"Новые сериалы и сезоны",uk:"Нові серіали та сезони",en:"New Series and Seasons"},trailers_upcoming_series:{ru:"Ожидаемые сериалы",uk:"Очікувані серіали",en:"Upcoming Series"},trailers_no_trailers:{ru:"Нет трейлеров",uk:"Немає трейлерів",en:"No trailers"},trailers_no_ua_trailer:{ru:"Нет украинского трейлера",uk:"Немає українського трейлера",en:"No Ukrainian trailer"},trailers_no_ru_trailer:{ru:"Нет русского трейлера",uk:"Немає російського трейлера",en:"No Russian trailer"},trailers_view:{ru:"Подробнее",uk:"Докладніше",en:"More"},title_trailers:{ru:"Трейлеры",uk:"Трейлери",en:"Trailers"},trailers_filter:{ru:"Фильтр",uk:"Фільтр",en:"Filter"},trailers_filter_today:{ru:"Сегодня",uk:"Сьогодні",en:"Today"},trailers_filter_week:{ru:"Неделя",uk:"Тиждень",en:"Week"},trailers_filter_month:{ru:"Месяц",uk:"Місяць",en:"Month"},trailers_filter_year:{ru:"Год",uk:"Рік",en:"Year"},trailers_movies:{ru:"Фильмы",uk:"Фільми",en:"Movies"},trailers_series:{ru:"Сериалы",uk:"Серіали",en:"Series"},trailers_more:{ru:"Ещё",uk:"Ще",en:"More"},trailers_popular_movies:{ru:"Популярные фильмы",uk:"Популярні фільми",en:"Popular Movies"},trailers_last_movie:{ru:"Это последний фильм: [title]",uk:"Це останній фільм: [title]",en:"This is the last movie: [title]"},trailers_no_more_data:{ru:"Больше нет данных для загрузки",uk:"Більше немає даних для завантаження",en:"No more data to load"}};function startPlugin(){window.plugin_trailers_ready||(window.plugin_trailers_ready=!0,Lampa.Lang.add(l),Lampa.Component.add("trailers_main",Component$1),Lampa.Component.add("trailers_full",Component),function initTemplates(){Lampa.Template.add("trailer",'<div class="card selector card--trailer layer--render layer--visible"><div class="card__view"><img src="./img/img_load.svg" class="card__img"><div class="card__promo"><div class="card__promo-text"><div class="card__title"></div></div><div class="card__details"></div></div></div><div class="card__play"><img src="./img/icons/player/play.svg"></div></div>'),Lampa.Template.add("trailer_style","<style>.card.card--trailer,.card-more.more--trailers{width:25.7em}.card.card--trailer .card__view{padding-bottom:56%;margin-bottom:0}.card.card--trailer .card__details{margin-top:0.8em}.card.card--trailer .card__play{position:absolute;top:50%;transform:translateY(-50%);left:1.5em;background:#000000b8;width:2.2em;height:2.2em;border-radius:100%;text-align:center;padding-top:0.6em}.card.card--trailer .card__play img{width:0.9em;height:1em}.card.card--trailer .card__rating{position:absolute;bottom:0.5em;right:0.5em;background:#000000b8;padding:0.2em 0.5em;border-radius:3px;font-size:1.2em}.card.card--trailer .card__trailer-lang{position:absolute;top:0.5em;right:0.5em;background:#000000b8;padding:0.2em 0.5em;border-radius:3px;text-transform:uppercase;font-size:1.2em}.card.card--trailer .card__release-date{position:absolute;top:2em;right:0.5em;background:#000000b8;padding:0.2em 0.5em;border-radius:3px;font-size:1.2em}.card-more.more--trailers .card-more__box{padding-bottom:56%}.category-full--trailers{display:flex;flex-wrap:wrap;justify-content:space-between}.category-full--trailers .card{width:33.3%;margin-bottom:1.5em}.category-full--trailers .card .card__view{padding-bottom:56%;margin-bottom:0}.items-line__more{display:inline-block;margin-left:10px;cursor:pointer;padding:0.5em 1em}@media screen and (max-width:767px){.category-full--trailers .card{width:50%}}@media screen and (max-width:400px){.category-full--trailers .card{width:100%}}</style>")}(),Lampa.TMDB&&Lampa.TMDB.key()?function add(){var e=$('<li class="menu__item selector"><div class="menu__ico"><svg height="70" viewBox="0 0 80 70" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M71.2555 2.08955C74.6975 3.2397 77.4083 6.62804 78.3283 10.9306C80 18.7291 80 35 80 35C80 35 80 51.2709 78.3283 59.0694C77.4083 63.372 74.6975 66.7603 71.2555 67.9104C65.0167 70 40 70 40 70C40 70 14.9833 70 8.74453 67.9104C5.3025 66.7603 2.59172 63.372 1.67172 59.0694C0 51.2709 0 35 0 35C0 35 0 18.7291 1.67172 10.9306C2.59172 6.62804 5.3025 3.2395 8.74453 2.08955C14.9833 0 40 0 40 0C40 0 65.0167 0 71.2555 2.08955ZM55.5909 35.0004L29.9773 49.5714V20.4286L55.5909 35.0004Z" fill="currentColor"/></svg></div><div class="menu__text">'+Lampa.Lang.translate("title_trailers")+"</div></li>");e.on("hover:enter",(function(){Lampa.Activity.push({url:"",title:Lampa.Lang.translate("title_trailers"),component:"trailers_main",page:1})})),$(".menu .menu__list").eq(0).append(e),$("body").append(Lampa.Template.get("trailer_style",{},!0)),Lampa.Storage.listener.follow("change",(function(e){"language"===e.name&&n.clear()}))}():Lampa.Noty.show("TMDB API key is missing. Trailers plugin cannot be loaded."))}window.appready?startPlugin():Lampa.Listener.follow("app",(function(e){"ready"===e.type&&startPlugin()}));