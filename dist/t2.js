(()=>{var e={430:()=>{}},t={};function a(r){var i=t[r];if(void 0!==i)return i.exports;var n=t[r]={exports:{}};return e[r](n,n.exports,a),n.exports}a.d=(e,t)=>{for(var r in t)a.o(t,r)&&!a.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),a.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{"use strict";var e={};a.r(e),a.d(e,{y:()=>s});var t=a(430);function r(e){if(!e)return"-";var t=new Date(e);return String(t.getDate()).padStart(2,"0")+"."+String(t.getMonth()+1).padStart(2,"0")+"."+t.getFullYear()}function i(e,a){this.build=function(){if(this.card=Lampa.Template.get("trailer",e),this.img=this.card.find("img")[0],this.is_youtube="rating"===a.type,this.rating=e.vote_average?e.vote_average.toFixed(1):"-",this.trailer_lang="",this.release_date="-",this.is_youtube)this.card.find(".card__title").text(e.name),this.card.find(".card__details").remove();else{var t=((e.release_date||e.first_air_date||"0000")+"").slice(0,4),r=e.title||e.name||e.original_title||e.original_name;this.card.find(".card__title").text(r),this.card.find(".card__details").text(t+" - "+(e.original_title||e.original_name)),"-"!==this.rating?this.card.find(".card__view").append('<div class="card__rating">'+this.rating+"</div>"):this.card.find(".card__view").append('<div class="card__rating">-</div>'),this.card.find(".card__view").append('<div class="card__trailer-lang"></div>'),this.card.find(".card__view").append('<div class="card__release-date"></div>')}},this.cardImgBackground=function(t){return Lampa.Storage.field("background")?"poster"===Lampa.Storage.get("background_type","complex")&&window.innerWidth>790?t.backdrop_path?Lampa.Api.img(t.backdrop_path,"original"):this.is_youtube?"https://img.youtube.com/vi/"+e.id+"/hqdefault.jpg":"":t.backdrop_path?Lampa.Api.img(t.backdrop_path,"w500"):this.is_youtube?"https://img.youtube.com/vi/"+e.id+"/hqdefault.jpg":"":""},this.image=function(){var e=this;this.img.onload=function(){e.card.addClass("card--loaded")},this.img.onerror=function(){e.img.src="./img/img_broken.svg"}},this.loadTrailerInfo=function(){var i=this;this.is_youtube||this.trailer_lang||t.Api.videos(e,(function(n){var o,l=n.results?n.results.filter((function(e){return"Trailer"===e.type})):[],s=(0,t.getPreferredLanguage)(),d=l.find((function(e){return s.includes(e.iso_639_1)}))||l[0];if(i.trailer_lang=d?d.iso_639_1:"-","-"!==i.trailer_lang?i.card.find(".card__trailer-lang").text(i.trailer_lang.toUpperCase()):i.card.find(".card__trailer-lang").text("-"),"in_theaters"===a.type||"upcoming_movies"===a.type)if(e.release_details&&e.release_details.results){var c="uk"===(o=Lampa.Storage.get("language","ru"))?"UA":"ru"===o?"RU":"US",p=e.release_details.results.find((function(e){return e.iso_3166_1===c}));if(p&&p.release_dates&&p.release_dates.length){var u=p.release_dates[0].release_date;i.release_date=r(u)}else e.release_date&&(i.release_date=r(e.release_date))}else e.release_date&&(i.release_date=r(e.release_date));else"new_series_seasons"!==a.type&&"upcoming_series"!==a.type||e.release_details&&e.release_details.first_air_date&&(i.release_date=r(e.release_details.first_air_date));i.card.find(".card__release-date").text(i.release_date)}),(function(){i.trailer_lang="-",i.card.find(".card__trailer-lang").text("-"),i.card.find(".card__release-date").text("-")}))},this.play=function(t){if(t)try{if(Lampa.Manifest.app_digital>=183){var a={title:Lampa.Utils.shortText(e.title||e.name,50),id:t,youtube:!0,url:"https://www.youtube.com/watch?v="+t,icon:'<img class="size-youtube" src="https://img.youtube.com/vi/'+t+'/default.jpg" />',template:"selectbox_icon"};Lampa.Player.play(a),Lampa.Player.playlist([a])}else Lampa.YouTube.play(t)}catch(e){Lampa.Noty.show("Помилка відтворення трейлера: "+e.message)}else Lampa.Noty.show(Lampa.Lang.translate("trailers_no_trailers"))},this.create=function(){var a=this;this.build(),this.card.on("hover:focus",(function(t,r){Lampa.Background.change(a.cardImgBackground(e)),a.onFocus(t.target,e,r),a.loadTrailerInfo()})).on("hover:enter",(function(){a.is_youtube?a.play(e.id):t.Api.videos(e,(function(e){var r=(0,t.getPreferredLanguage)(),i=e.results?e.results.filter((function(e){return"Trailer"===e.type})):[],n=i.find((function(e){return r.includes(e.iso_639_1)}))||i[0];n&&n.key?("uk"===r[0]&&"uk"!==n.iso_639_1&&"en"!==n.iso_639_1?Lampa.Noty.show(Lampa.Lang.translate("trailers_no_ua_trailer")):"ru"===r[0]&&"ru"!==n.iso_639_1&&"en"!==n.iso_639_1&&Lampa.Noty.show(Lampa.Lang.translate("trailers_no_ru_trailer")),a.play(n.key)):Lampa.Noty.show(Lampa.Lang.translate("trailers_no_trailers"))}),(function(){Lampa.Noty.show(Lampa.Lang.translate("trailers_no_trailers"))}))})).on("hover:long",(function(){if(!a.is_youtube){var r=[{title:Lampa.Lang.translate("trailers_view"),view:!0}];Lampa.Loading.start((function(){t.Api.clear(),Lampa.Loading.stop()})),t.Api.videos(e,(function(i){Lampa.Loading.stop();var n=(0,t.getPreferredLanguage)(),o=i.results?i.results.filter((function(e){return"Trailer"===e.type})):[];o.length&&(r.push({title:Lampa.Lang.translate("title_trailers"),separator:!0}),o.forEach((function(e){e.key&&n.includes(e.iso_639_1)&&r.push({title:e.name||"Trailer",id:e.key,subtitle:e.iso_639_1})}))),Lampa.Select.show({title:Lampa.Lang.translate("title_action"),items:r,onSelect:function(t){Lampa.Controller.toggle("content"),t.view?Lampa.Activity.push({url:"",component:"full",id:e.id,method:e.name?"tv":"movie",card:e,source:"tmdb"}):a.play(t.id)},onBack:function(){Lampa.Controller.toggle("content")}})}),(function(){Lampa.Loading.stop(),Lampa.Noty.show(Lampa.Lang.translate("trailers_no_trailers"))}))}})),this.image(),this.loadTrailerInfo()},this.destroy=function(){this.img.onerror=null,this.img.onload=null,this.img.src="",this.card.remove(),this.card=null,this.img=null},this.visible=function(){this.visibled||("rating"===a.type?this.img.src="https://img.youtube.com/vi/"+e.id+"/hqdefault.jpg":e.backdrop_path?this.img.src=Lampa.Api.img(e.backdrop_path,"w500"):e.poster_path?this.img.src=Lampa.Api.img(e.poster_path):this.img.src="./img/img_broken.svg",this.visibled=!0)},this.render=function(){return this.card}}function n(e){var t,a,r,n,o=this,l=Lampa.Template.get("items_line",{title:e.title}),s=l.find(".items-line__body"),d=new Lampa.Scroll({horizontal:!0,step:600}),c=Lampa.Storage.field("light_version")&&window.innerWidth>=767,p=[],u=c?6:10,m=0,g=!1;function _(){if(!g){g=!0;var t=e.results.slice(m,m+u);t.length>0?(t.forEach((function(t){var a=new i(t,{type:e.type});a.create(),a.visible(),a.onFocus=function(e,t,r){if(n=e,p.indexOf(a),o.onFocus&&o.onFocus(t),d.update(a.render(),!0),p.length>0&&p.indexOf(a)===p.length-1){var i=Lampa.Lang.translate("trailers_last_movie").replace("[title]",t.title||t.name);Lampa.Noty.show(i)}},d.append(a.render()),p.push(a)})),m+=t.length,Lampa.Layer.update(),g=!1):(Lampa.Activity.push({url:e.url,title:e.title,component:"trailers_full",type:e.type,page:Math.floor(m/u)+2}),g=!1)}}this.create=function(){d.render().find(".scroll__body").addClass("items-cards"),l.find(".items-line__title").text(e.title),(a=$('<div class="items-line__more selector"><svg width="36" height="36" viewBox="0 0 24 24" fill="currentColor"><path d="M10 18h4v-2h-4v2zM3 6v2h18V6H3zm3 7h12v-2H6v2z"/></svg></div>')).css({display:"inline-block",marginLeft:"10px",cursor:"pointer",padding:"0.5em",background:"transparent",border:"none"}),a.on("hover:enter",(function(){var t=[{title:Lampa.Lang.translate("trailers_filter_today"),value:"day",selected:"day"===Lampa.Storage.get("trailers_"+e.type+"_filter","day")},{title:Lampa.Lang.translate("trailers_filter_week"),value:"week",selected:"week"===Lampa.Storage.get("trailers_"+e.type+"_filter","day")},{title:Lampa.Lang.translate("trailers_filter_month"),value:"month",selected:"month"===Lampa.Storage.get("trailers_"+e.type+"_filter","day")},{title:Lampa.Lang.translate("trailers_filter_year"),value:"year",selected:"year"===Lampa.Storage.get("trailers_"+e.type+"_filter","day")}];Lampa.Select.show({title:Lampa.Lang.translate("trailers_filter"),items:t,onSelect:function(t){Lampa.Storage.set("trailer_category_cache_"+e.type,null),categoryCache[e.type]=null,Lampa.Storage.set("trailers_"+e.type+"_filter",t.value),Lampa.Activity.push({url:"day"===t.value||"week"===t.value?"/discover/"+(e.type.includes("movie")?"movie":"tv")+"?sort_by=popularity.desc":"month"===t.value?"/discover/"+(e.type.includes("movie")?"movie":"tv")+"?sort_by=popularity.desc&release_date.gte="+getFormattedDate(30):"/discover/"+(e.type.includes("movie")?"movie":"tv")+"?sort_by=popularity.desc&release_date.gte="+getFormattedDate(365),title:e.title,component:"trailers_main",type:e.type,page:1})},onBack:function(){Lampa.Controller.toggle("content")}})})),(r=$('<div class="items-line__more selector">'+Lampa.Lang.translate("trailers_more")+"</div>")).on("hover:enter",(function(){Lampa.Activity.push({url:e.url,title:e.title,component:"trailers_full",type:e.type,page:Math.floor(m/u)+2})})),l.find(".items-line__title").after(a),a.after(r),this.bind(),s.append(d.render());var t,i,n=(t=function(){d.isEnd()&&!g&&_()},function(){var e=this,a=arguments;clearTimeout(i),i=setTimeout((function(){t.apply(e,a)}),200)});d.render().on("scroll",n)},this.bind=function(){_(),this.more(),Lampa.Layer.update()},this.cardImgBackground=function(e){return Lampa.Storage.field("background")?"poster"===Lampa.Storage.get("background_type","complex")&&window.innerWidth>790?e.backdrop_path?Lampa.Api.img(e.backdrop_path,"original"):"":e.backdrop_path?Lampa.Api.img(e.backdrop_path,"w500"):"":""},this.more=function(){(t=Lampa.Template.get("more")).addClass("more--trailers"),t.on("hover:enter",(function(){Lampa.Activity.push({url:e.url,title:e.title,component:"trailers_full",type:e.type,page:Math.floor(m/u)+2})})),t.on("hover:focus",(function(e){n=e.target,d.update(t,!0)})),d.append(t)},this.toggle=function(){var e=this;Lampa.Controller.add("items_line",{toggle:function(){Lampa.Controller.collectionSet(d.render()),Lampa.Controller.collectionFocus(!!p.length&&n,d.render()),n&&p.length&&d.update($(n),!0)},right:function(){Navigator.canmove("right")&&(Navigator.move("right"),n&&p.length&&d.update($(n),!0)),Lampa.Controller.enable("items_line")},left:function(){Navigator.canmove("left")?(Navigator.move("left"),n&&p.length&&d.update($(n),!0)):e.onLeft?e.onLeft():Lampa.Controller.toggle("menu")},down:this.onDown,up:this.onUp,gone:function(){},back:this.onBack}),Lampa.Controller.toggle("items_line")},this.render=function(){return l},this.destroy=function(){Lampa.Arrays.destroy(p),d.destroy(),l.remove(),t&&t.remove(),a&&a.remove(),r&&r.remove(),p=[]}}function o(e){var a,r=this,n=new Lampa.Scroll({mask:!0,over:!0}),o=[],l=$("<div></div>"),s=0;this.create=function(){return n.render().addClass("trailers-full"),t.Api.full(e,(function(t){if((t.results||[]).forEach((function(t,r){var l=new i(t,{type:e.type});l.create(),o.push(l),n.append(l.render()),0===r&&(a=l.card,l.card.addClass("card--focus"))})),t.total_pages>t.page){var l=Lampa.Template.get("more",{}),d=new i(l,{type:"more"});d.create(),(l=d.render()).addClass("selector"),l.on("hover:enter",(function(){Lampa.Activity.push({url:e.url,title:e.title,component:"trailers_full",type:e.type,page:t.page+1})})),n.append(l),o.push(d)}n.onWheel=function(e){e>0&&s<o.length-1?r.right():e<0&&s>0&&r.left()},r.toggle()}),(function(){Lampa.Noty.show(Lampa.Lang.translate("trailers_no_data"))})),l.append(n.render()),l},this.left=function(){s>0&&(s--,a=o[s].card,Lampa.Controller.moveTo(a,n.render()),n.scrollTo(a))},this.right=function(){s<o.length-1&&(s++,a=o[s].card,Lampa.Controller.moveTo(a,n.render()),n.scrollTo(a))},this.toggle=function(){Lampa.Controller.add("trailers_full",{toggle:function(){Lampa.Controller.collectionSet(n.render()),a&&Lampa.Controller.collectionFocus(a,n.render())},left:function(){r.left()},right:function(){r.right()},up:function(){Lampa.Controller.toggle("menu")},down:function(){Lampa.Controller.toggle("content")},back:function(){Lampa.Controller.toggle("menu")}}),Lampa.Controller.toggle("trailers_full")},this.render=function(){return l},this.destroy=function(){n.destroy(),o.forEach((function(e){e.destroy()})),l.remove()}}function l(e){var a=this,r=new Lampa.Scroll({mask:!0,over:!0}),i=[],o=$("<div></div>");this.create=function(){return r.render().addClass("trailers-main"),t.Api.main((function(e){e.forEach((function(e){var t=new n(e);t.create(),i.push(t),r.append(t.render())})),a.toggle()}),(function(){Lampa.Noty.show(Lampa.Lang.translate("trailers_no_data"))})),o.append(r.render()),o},this.start=function(){Lampa.Controller.toggle("trailers_main")},this.toggle=function(){Lampa.Controller.add("trailers_main",{toggle:function(){Lampa.Controller.collectionSet(r.render()),Lampa.Controller.collectionFocus(!1,r.render())},up:function(){Lampa.Controller.toggle("menu")},down:function(){Lampa.Controller.toggle("content")},back:function(){Lampa.Controller.toggle("menu")}}),Lampa.Controller.toggle("trailers_main")},this.render=function(){return o},this.destroy=function(){r.destroy(),i.forEach((function(e){e.destroy()})),o.remove()}}function s(){Lampa.Template.add("trailer",['<div class="card card--trailer selector">','    <div class="card__view">','        <img class="card__img" />',"    </div>",'    <div class="card__info">','        <div class="card__title"></div>','        <div class="card__details"></div>',"    </div>","</div>"].join("")),Lampa.Template.add("items_line",['<div class="items-line">','    <div class="items-line__header">','        <div class="items-line__title"></div>',"    </div>",'    <div class="items-line__body"></div>',"</div>"].join("")),Lampa.Template.add("more",['<div class="card card--more selector">','    <div class="card__view">','        <div class="card__more">','            <svg width="36" height="36" viewBox="0 0 24 24" fill="currentColor">','                <path d="M12 22c1.1 0 2-.9 2-2h-4c0 1.1.9 2 2 2zm6-6v-5c0-3.07-1.63-5.64-4.5-6.32V4c0-1.1-.9-2-2-2s-2 .9-2 2v.68C6.63 5.36 5 7.92 5 11v5l-2 2v1h18v-1l-2-2z"/>',"            </svg>","        </div>","    </div>","</div>"].join(""))}function d(){var a;window.plugin_trailers_ready||(window.plugin_trailers_ready=!0,Lampa.Lang.add(e.translations),Lampa.Component.add("trailers_main",l),Lampa.Component.add("trailers_full",o),s(),Lampa.TMDB&&Lampa.TMDB.key()?((a=$('<li class="menu__item selector"><div class="menu__ico"><svg height="70" viewBox="0 0 80 70" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M71.2555 2.08955C74.6975 3.2397 77.4083 6.62804 78.3283 10.9306C80 18.7291 80 35 80 35C80 35 80 51.2709 78.3283 59.0694C77.4083 63.372 74.6975 66.7603 71.2555 67.9104C65.0167 70 40 70 40 70C40 70 14.9833 70 8.74453 67.9104C5.3025 66.7603 2.59172 63.372 1.67172 59.0694C0 51.2709 0 35 0 35C0 35 0 18.7291 1.67172 10.9306C2.59172 6.62804 5.3025 3.2395 8.74453 2.08955C14.9833 0 40 0 40 0C40 0 65.0167 0 71.2555 2.08955ZM55.5909 35.0004L29.9773 49.5714V20.4286L55.5909 35.0004Z" fill="currentColor"/></svg></div><div class="menu__text">'+Lampa.Lang.translate("title_trailers")+"</div></li>")).on("hover:enter",(function(){Lampa.Activity.push({url:"",title:Lampa.Lang.translate("title_trailers"),component:"trailers_main",page:1})})),$(".menu .menu__list").eq(0).append(a),$("body").append(Lampa.Template.get("trailer_style",{},!0)),Lampa.Storage.listener.follow("change",(function(e){"language"===e.name&&t.Api.clear()}))):Lampa.Noty.show("TMDB API key is missing. Trailers plugin cannot be loaded."))}window.appready?d():Lampa.Listener.follow("app",(function(e){"ready"===e.type&&d()}))})()})();